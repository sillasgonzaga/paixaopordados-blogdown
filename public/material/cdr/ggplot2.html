<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>12 Visualizações de dados (ggplot2) | Ciência de Dados com R - Introdução</title>
  <meta name="description" content="Aprendendo a programar com R" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="12 Visualizações de dados (ggplot2) | Ciência de Dados com R - Introdução" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Aprendendo a programar com R" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="12 Visualizações de dados (ggplot2) | Ciência de Dados com R - Introdução" />
  
  <meta name="twitter:description" content="Aprendendo a programar com R" />
  

<meta name="author" content="Saulo Guerra, Paulo Felipe de Oliveira, Robert McDonnell e Sillas Gonzaga" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="estruturas-complexas-de-dados.html"/>
<link rel="next" href="htmlwidgets.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.4.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
<link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet" />
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script>
<script src="libs/dygraphs-1.1.1/shapes.js"></script>
<script src="libs/moment-2.8.4/moment.js"></script>
<script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
<script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script>
<script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-61574597-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-61574597-1');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Ciência de Dados com R - Introdução</a></li>
<img src="hexcdr.png" class="hexcurso" alt="hex">

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prefácio</a></li>
<li class="chapter" data-level="" data-path="sobre-os-autores.html"><a href="sobre-os-autores.html"><i class="fa fa-check"></i>Sobre os autores</a></li>
<li class="chapter" data-level="" data-path="download.html"><a href="download.html"><i class="fa fa-check"></i>Download</a></li>
<li class="chapter" data-level="1" data-path="introdução.html"><a href="introdução.html"><i class="fa fa-check"></i><b>1</b> Introdução</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introdução.html"><a href="introdução.html#o-que-é-ciência-de-dados"><i class="fa fa-check"></i><b>1.1</b> O que é Ciência de Dados?</a></li>
<li class="chapter" data-level="1.2" data-path="introdução.html"><a href="introdução.html#workflow-da-ciência-de-dados"><i class="fa fa-check"></i><b>1.2</b> Workflow da Ciência de Dados</a></li>
<li class="chapter" data-level="1.3" data-path="introdução.html"><a href="introdução.html#linguagens-para-ciência-de-dados"><i class="fa fa-check"></i><b>1.3</b> Linguagens para Ciência de dados</a></li>
<li class="chapter" data-level="1.4" data-path="introdução.html"><a href="introdução.html#o-que-é-r-e-por-que-devo-aprendê-lo"><i class="fa fa-check"></i><b>1.4</b> O que é R e por que devo aprendê-lo?</a></li>
<li class="chapter" data-level="1.5" data-path="introdução.html"><a href="introdução.html#rstudio"><i class="fa fa-check"></i><b>1.5</b> RStudio</a></li>
<li class="chapter" data-level="1.6" data-path="introdução.html"><a href="introdução.html#buscando-ajuda"><i class="fa fa-check"></i><b>1.6</b> Buscando Ajuda</a></li>
<li class="chapter" data-level="1.7" data-path="introdução.html"><a href="introdução.html#exercícios"><i class="fa fa-check"></i><b>1.7</b> Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="conceitos-básicos.html"><a href="conceitos-básicos.html"><i class="fa fa-check"></i><b>2</b> Conceitos Básicos</a>
<ul>
<li class="chapter" data-level="2.1" data-path="conceitos-básicos.html"><a href="conceitos-básicos.html#console"><i class="fa fa-check"></i><b>2.1</b> Console</a></li>
<li class="chapter" data-level="2.2" data-path="conceitos-básicos.html"><a href="conceitos-básicos.html#scripts"><i class="fa fa-check"></i><b>2.2</b> Scripts</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="conceitos-básicos.html"><a href="conceitos-básicos.html#salvando-scripts"><i class="fa fa-check"></i><b>2.2.1</b> Salvando Scripts</a></li>
<li class="chapter" data-level="2.2.2" data-path="conceitos-básicos.html"><a href="conceitos-básicos.html#comentários-de-código"><i class="fa fa-check"></i><b>2.2.2</b> Comentários de Código</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="conceitos-básicos.html"><a href="conceitos-básicos.html#objetos-variáveis"><i class="fa fa-check"></i><b>2.3</b> Objetos (Variáveis)</a></li>
<li class="chapter" data-level="2.4" data-path="conceitos-básicos.html"><a href="conceitos-básicos.html#funções"><i class="fa fa-check"></i><b>2.4</b> Funções</a></li>
<li class="chapter" data-level="2.5" data-path="conceitos-básicos.html"><a href="conceitos-básicos.html#pacotes"><i class="fa fa-check"></i><b>2.5</b> Pacotes</a></li>
<li class="chapter" data-level="2.6" data-path="conceitos-básicos.html"><a href="conceitos-básicos.html#boas-práticas"><i class="fa fa-check"></i><b>2.6</b> Boas práticas</a></li>
<li class="chapter" data-level="2.7" data-path="conceitos-básicos.html"><a href="conceitos-básicos.html#tidyverse"><i class="fa fa-check"></i><b>2.7</b> Tidyverse</a></li>
<li class="chapter" data-level="2.8" data-path="conceitos-básicos.html"><a href="conceitos-básicos.html#exercícios-1"><i class="fa fa-check"></i><b>2.8</b> Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="lendo-os-dados.html"><a href="lendo-os-dados.html"><i class="fa fa-check"></i><b>3</b> Lendo os dados</a>
<ul>
<li class="chapter" data-level="3.1" data-path="lendo-os-dados.html"><a href="lendo-os-dados.html#tipos-de-estrutura-dos-dados"><i class="fa fa-check"></i><b>3.1</b> Tipos de Estrutura dos Dados</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="lendo-os-dados.html"><a href="lendo-os-dados.html#dados-estruturados"><i class="fa fa-check"></i><b>3.1.1</b> Dados Estruturados</a></li>
<li class="chapter" data-level="3.1.2" data-path="lendo-os-dados.html"><a href="lendo-os-dados.html#dados-não-estruturados"><i class="fa fa-check"></i><b>3.1.2</b> Dados Não Estruturados</a></li>
<li class="chapter" data-level="3.1.3" data-path="lendo-os-dados.html"><a href="lendo-os-dados.html#dados-semiestruturados"><i class="fa fa-check"></i><b>3.1.3</b> Dados Semiestruturados</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="lendo-os-dados.html"><a href="lendo-os-dados.html#definindo-o-local-dos-dados"><i class="fa fa-check"></i><b>3.2</b> Definindo o Local dos Dados</a></li>
<li class="chapter" data-level="3.3" data-path="lendo-os-dados.html"><a href="lendo-os-dados.html#pacote-para-leitura-dos-dados"><i class="fa fa-check"></i><b>3.3</b> Pacote para leitura dos dados</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html"><i class="fa fa-check"></i><b>4</b> Manipulando os dados</a>
<ul>
<li class="chapter" data-level="4.1" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#tipos-de-variáveis-e-colunas"><i class="fa fa-check"></i><b>4.1</b> Tipos de Variáveis e Colunas</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#conversões-de-tipos-de-variáveis"><i class="fa fa-check"></i><b>4.1.1</b> Conversões de tipos de variáveis</a></li>
<li class="chapter" data-level="4.1.2" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#outros-tipos-de-variáveis"><i class="fa fa-check"></i><b>4.1.2</b> Outros tipos de variáveis</a></li>
<li class="chapter" data-level="4.1.3" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#valores-faltantes-e-o-na"><i class="fa fa-check"></i><b>4.1.3</b> Valores faltantes e o ‘NA’</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#estruturas-de-controle-de-fluxo"><i class="fa fa-check"></i><b>4.2</b> Estruturas de Controle de Fluxo</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#if-e-else"><i class="fa fa-check"></i><b>4.2.1</b> If e Else</a></li>
<li class="chapter" data-level="4.2.2" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#loops"><i class="fa fa-check"></i><b>4.2.2</b> Loops</a></li>
<li class="chapter" data-level="4.2.3" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#funções-1"><i class="fa fa-check"></i><b>4.2.3</b> Funções</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#manipulações-com-r-base"><i class="fa fa-check"></i><b>4.3</b> Manipulações com R base</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#trabalhando-com-colunas-de-um-data.frame"><i class="fa fa-check"></i><b>4.3.1</b> Trabalhando com colunas de um data.frame</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#pacote-dplyr"><i class="fa fa-check"></i><b>4.4</b> Pacote dplyr</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#verbetes-do-dplyr-e-o-operador"><i class="fa fa-check"></i><b>4.4.1</b> Verbetes do dplyr e o operador <code>%&gt;%</code></a></li>
<li class="chapter" data-level="4.4.2" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#select"><i class="fa fa-check"></i><b>4.4.2</b> Select</a></li>
<li class="chapter" data-level="4.4.3" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#mutate"><i class="fa fa-check"></i><b>4.4.3</b> Mutate</a></li>
<li class="chapter" data-level="4.4.4" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#filter"><i class="fa fa-check"></i><b>4.4.4</b> Filter</a></li>
<li class="chapter" data-level="4.4.5" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#group-by-e-summarise"><i class="fa fa-check"></i><b>4.4.5</b> Group By e Summarise</a></li>
<li class="chapter" data-level="4.4.6" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#arrange"><i class="fa fa-check"></i><b>4.4.6</b> Arrange</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#exercícios-2"><i class="fa fa-check"></i><b>4.5</b> Exercícios</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#parte-1"><i class="fa fa-check"></i><b>4.5.1</b> Parte 1</a></li>
<li class="chapter" data-level="4.5.2" data-path="manipulando-os-dados.html"><a href="manipulando-os-dados.html#parte-2"><i class="fa fa-check"></i><b>4.5.2</b> Parte 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="limpando-dados.html"><a href="limpando-dados.html"><i class="fa fa-check"></i><b>5</b> Limpando dados</a>
<ul>
<li class="chapter" data-level="5.1" data-path="limpando-dados.html"><a href="limpando-dados.html#o-formato-ideal-dos-dados"><i class="fa fa-check"></i><b>5.1</b> O formato “ideal” dos dados</a></li>
<li class="chapter" data-level="5.2" data-path="limpando-dados.html"><a href="limpando-dados.html#pacote-tidyr"><i class="fa fa-check"></i><b>5.2</b> Pacote tidyr</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="limpando-dados.html"><a href="limpando-dados.html#pivot_longer"><i class="fa fa-check"></i><b>5.2.1</b> pivot_longer()</a></li>
<li class="chapter" data-level="5.2.2" data-path="limpando-dados.html"><a href="limpando-dados.html#pivot_wider"><i class="fa fa-check"></i><b>5.2.2</b> pivot_wider()</a></li>
<li class="chapter" data-level="5.2.3" data-path="limpando-dados.html"><a href="limpando-dados.html#separate"><i class="fa fa-check"></i><b>5.2.3</b> separate</a></li>
<li class="chapter" data-level="5.2.4" data-path="limpando-dados.html"><a href="limpando-dados.html#unite"><i class="fa fa-check"></i><b>5.2.4</b> unite</a></li>
<li class="chapter" data-level="5.2.5" data-path="limpando-dados.html"><a href="limpando-dados.html#separate_rows"><i class="fa fa-check"></i><b>5.2.5</b> separate_rows</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="limpando-dados.html"><a href="limpando-dados.html#exercicios"><i class="fa fa-check"></i><b>5.3</b> Exercicios</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="juntando-dados.html"><a href="juntando-dados.html"><i class="fa fa-check"></i><b>6</b> Juntando dados</a>
<ul>
<li class="chapter" data-level="6.1" data-path="juntando-dados.html"><a href="juntando-dados.html#união-de-dados-union"><i class="fa fa-check"></i><b>6.1</b> União de dados (Union)</a></li>
<li class="chapter" data-level="6.2" data-path="juntando-dados.html"><a href="juntando-dados.html#cruzamento-de-dados-join"><i class="fa fa-check"></i><b>6.2</b> Cruzamento de Dados (Join)</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="juntando-dados.html"><a href="juntando-dados.html#inner-join-ou-apenas-join"><i class="fa fa-check"></i><b>6.2.1</b> Inner Join (ou apenas Join)</a></li>
<li class="chapter" data-level="6.2.2" data-path="juntando-dados.html"><a href="juntando-dados.html#left-outer-join"><i class="fa fa-check"></i><b>6.2.2</b> Left Outer Join</a></li>
<li class="chapter" data-level="6.2.3" data-path="juntando-dados.html"><a href="juntando-dados.html#right-outer-join"><i class="fa fa-check"></i><b>6.2.3</b> Right Outer Join</a></li>
<li class="chapter" data-level="6.2.4" data-path="juntando-dados.html"><a href="juntando-dados.html#full-outer-join"><i class="fa fa-check"></i><b>6.2.4</b> Full Outer Join</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="juntando-dados.html"><a href="juntando-dados.html#exercícios-3"><i class="fa fa-check"></i><b>6.3</b> Exercícios</a></li>
<li class="chapter" data-level="6.4" data-path="juntando-dados.html"><a href="juntando-dados.html#exercícios-gerais-do-tidyverse"><i class="fa fa-check"></i><b>6.4</b> Exercícios gerais do Tidyverse</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="dados-em-strings-texto.html"><a href="dados-em-strings-texto.html"><i class="fa fa-check"></i><b>7</b> Dados em strings (texto)</a>
<ul>
<li class="chapter" data-level="7.1" data-path="dados-em-strings-texto.html"><a href="dados-em-strings-texto.html#pacote-stringr"><i class="fa fa-check"></i><b>7.1</b> Pacote stringr</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="dados-em-strings-texto.html"><a href="dados-em-strings-texto.html#extrair-parte-de-uma-string"><i class="fa fa-check"></i><b>7.1.1</b> Extrair parte de uma string</a></li>
<li class="chapter" data-level="7.1.2" data-path="dados-em-strings-texto.html"><a href="dados-em-strings-texto.html#substituir-caracteres-em-um-string"><i class="fa fa-check"></i><b>7.1.2</b> Substituir caracteres em um string</a></li>
<li class="chapter" data-level="7.1.3" data-path="dados-em-strings-texto.html"><a href="dados-em-strings-texto.html#buscar-correspondências-em-um-string"><i class="fa fa-check"></i><b>7.1.3</b> Buscar correspondências em um string</a></li>
<li class="chapter" data-level="7.1.4" data-path="dados-em-strings-texto.html"><a href="dados-em-strings-texto.html#complementar-uma-string"><i class="fa fa-check"></i><b>7.1.4</b> Complementar uma string</a></li>
<li class="chapter" data-level="7.1.5" data-path="dados-em-strings-texto.html"><a href="dados-em-strings-texto.html#remover-espaços-em-branco-desnecessários"><i class="fa fa-check"></i><b>7.1.5</b> Remover espaços em branco desnecessários</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="dados-em-strings-texto.html"><a href="dados-em-strings-texto.html#regex"><i class="fa fa-check"></i><b>7.2</b> Regex</a></li>
<li class="chapter" data-level="7.3" data-path="dados-em-strings-texto.html"><a href="dados-em-strings-texto.html#exercícios-4"><i class="fa fa-check"></i><b>7.3</b> Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="trabalhando-com-datas.html"><a href="trabalhando-com-datas.html"><i class="fa fa-check"></i><b>8</b> Trabalhando com datas</a>
<ul>
<li class="chapter" data-level="8.1" data-path="trabalhando-com-datas.html"><a href="trabalhando-com-datas.html#gerar-um-vetor-sequencial-de-datas"><i class="fa fa-check"></i><b>8.1</b> Gerar um vetor sequencial de datas</a></li>
<li class="chapter" data-level="8.2" data-path="trabalhando-com-datas.html"><a href="trabalhando-com-datas.html#parsear-datas-e-horários"><i class="fa fa-check"></i><b>8.2</b> ‘Parsear’ datas e horários</a></li>
<li class="chapter" data-level="8.3" data-path="trabalhando-com-datas.html"><a href="trabalhando-com-datas.html#extrair-componentes-de-uma-data"><i class="fa fa-check"></i><b>8.3</b> Extrair componentes de uma data</a></li>
<li class="chapter" data-level="8.4" data-path="trabalhando-com-datas.html"><a href="trabalhando-com-datas.html#operações-matemáticas-com-datas"><i class="fa fa-check"></i><b>8.4</b> Operações matemáticas com datas</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="escrevendo-dados.html"><a href="escrevendo-dados.html"><i class="fa fa-check"></i><b>9</b> Escrevendo dados</a>
<ul>
<li class="chapter" data-level="9.1" data-path="escrevendo-dados.html"><a href="escrevendo-dados.html#escrevendo-csv"><i class="fa fa-check"></i><b>9.1</b> Escrevendo csv</a></li>
<li class="chapter" data-level="9.2" data-path="escrevendo-dados.html"><a href="escrevendo-dados.html#rds"><i class="fa fa-check"></i><b>9.2</b> Rds</a></li>
<li class="chapter" data-level="9.3" data-path="escrevendo-dados.html"><a href="escrevendo-dados.html#escrevendo-outros-tipos-de-arquivos"><i class="fa fa-check"></i><b>9.3</b> Escrevendo outros tipos de arquivos</a></li>
<li class="chapter" data-level="9.4" data-path="escrevendo-dados.html"><a href="escrevendo-dados.html#exercícios-5"><i class="fa fa-check"></i><b>9.4</b> Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="obtendo-dados.html"><a href="obtendo-dados.html"><i class="fa fa-check"></i><b>10</b> Obtendo dados</a>
<ul>
<li class="chapter" data-level="10.1" data-path="obtendo-dados.html"><a href="obtendo-dados.html#api"><i class="fa fa-check"></i><b>10.1</b> API</a></li>
<li class="chapter" data-level="10.2" data-path="obtendo-dados.html"><a href="obtendo-dados.html#web-scrapping"><i class="fa fa-check"></i><b>10.2</b> Web Scrapping</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="estruturas-complexas-de-dados.html"><a href="estruturas-complexas-de-dados.html"><i class="fa fa-check"></i><b>11</b> Estruturas complexas de dados</a>
<ul>
<li class="chapter" data-level="11.1" data-path="estruturas-complexas-de-dados.html"><a href="estruturas-complexas-de-dados.html#introdução-a-listas"><i class="fa fa-check"></i><b>11.1</b> Introdução a listas</a></li>
<li class="chapter" data-level="11.2" data-path="estruturas-complexas-de-dados.html"><a href="estruturas-complexas-de-dados.html#introdução-ao-pacote-purrr"><i class="fa fa-check"></i><b>11.2</b> Introdução ao pacote purrr</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="estruturas-complexas-de-dados.html"><a href="estruturas-complexas-de-dados.html#map"><i class="fa fa-check"></i><b>11.2.1</b> <code>map()</code></a></li>
<li class="chapter" data-level="11.2.2" data-path="estruturas-complexas-de-dados.html"><a href="estruturas-complexas-de-dados.html#funções-derivadas-de-map"><i class="fa fa-check"></i><b>11.2.2</b> Funções derivadas de <code>map()</code></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="estruturas-complexas-de-dados.html"><a href="estruturas-complexas-de-dados.html#ideia-de-projeto-aplicando-uma-série-de-funções-a-uma-lista-de-arquivos"><i class="fa fa-check"></i><b>11.3</b> Ideia de projeto: Aplicando uma série de funções a uma lista de arquivos</a></li>
<li class="chapter" data-level="11.4" data-path="estruturas-complexas-de-dados.html"><a href="estruturas-complexas-de-dados.html#referências"><i class="fa fa-check"></i><b>11.4</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>12</b> Visualizações de dados (ggplot2)</a>
<ul>
<li class="chapter" data-level="12.1" data-path="ggplot2.html"><a href="ggplot2.html#dataset-do-módulo"><i class="fa fa-check"></i><b>12.1</b> Dataset do módulo</a></li>
<li class="chapter" data-level="12.2" data-path="ggplot2.html"><a href="ggplot2.html#mapeamento-estético"><i class="fa fa-check"></i><b>12.2</b> Mapeamento Estético</a></li>
<li class="chapter" data-level="12.3" data-path="ggplot2.html"><a href="ggplot2.html#objetos-geométricos-e-tipos-de-gráficos"><i class="fa fa-check"></i><b>12.3</b> Objetos geométricos e tipos de gráficos</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="ggplot2.html"><a href="ggplot2.html#escolhendo-o-tipo-de-gráfico"><i class="fa fa-check"></i><b>12.3.1</b> Escolhendo o tipo de gráfico</a></li>
<li class="chapter" data-level="12.3.2" data-path="ggplot2.html"><a href="ggplot2.html#gráfico-de-dispersão-geom_point"><i class="fa fa-check"></i><b>12.3.2</b> Gráfico de Dispersão (<code>geom_point()</code>)</a></li>
<li class="chapter" data-level="12.3.3" data-path="ggplot2.html"><a href="ggplot2.html#gráficos-de-bolhas"><i class="fa fa-check"></i><b>12.3.3</b> Gráficos de Bolhas</a></li>
<li class="chapter" data-level="12.3.4" data-path="ggplot2.html"><a href="ggplot2.html#gráficos-de-barras"><i class="fa fa-check"></i><b>12.3.4</b> Gráficos de Barras</a></li>
<li class="chapter" data-level="12.3.5" data-path="ggplot2.html"><a href="ggplot2.html#gráficos-de-linhas"><i class="fa fa-check"></i><b>12.3.5</b> Gráficos de linhas</a></li>
<li class="chapter" data-level="12.3.6" data-path="ggplot2.html"><a href="ggplot2.html#histogramas"><i class="fa fa-check"></i><b>12.3.6</b> Histogramas</a></li>
<li class="chapter" data-level="12.3.7" data-path="ggplot2.html"><a href="ggplot2.html#boxplots-e-violinplots"><i class="fa fa-check"></i><b>12.3.7</b> Boxplots e violinplots</a></li>
<li class="chapter" data-level="12.3.8" data-path="ggplot2.html"><a href="ggplot2.html#textosrótulos"><i class="fa fa-check"></i><b>12.3.8</b> Textos/Rótulos</a></li>
<li class="chapter" data-level="12.3.9" data-path="ggplot2.html"><a href="ggplot2.html#anotações"><i class="fa fa-check"></i><b>12.3.9</b> Anotações</a></li>
<li class="chapter" data-level="12.3.10" data-path="ggplot2.html"><a href="ggplot2.html#cleveland-dot-plot"><i class="fa fa-check"></i><b>12.3.10</b> Cleveland Dot Plot</a></li>
<li class="chapter" data-level="12.3.11" data-path="ggplot2.html"><a href="ggplot2.html#mapas-de-calor"><i class="fa fa-check"></i><b>12.3.11</b> Mapas de calor</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="ggplot2.html"><a href="ggplot2.html#escalas"><i class="fa fa-check"></i><b>12.4</b> Escalas</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="ggplot2.html"><a href="ggplot2.html#tipos-de-variáveis"><i class="fa fa-check"></i><b>12.4.1</b> Tipos de Variáveis</a></li>
<li class="chapter" data-level="12.4.2" data-path="ggplot2.html"><a href="ggplot2.html#eixos"><i class="fa fa-check"></i><b>12.4.2</b> Eixos</a></li>
<li class="chapter" data-level="12.4.3" data-path="ggplot2.html"><a href="ggplot2.html#escalas-de-cores-color-e-preenchimento-fill"><i class="fa fa-check"></i><b>12.4.3</b> Escalas de Cores (color) e Preenchimento (fill)</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="ggplot2.html"><a href="ggplot2.html#subplots-facet"><i class="fa fa-check"></i><b>12.5</b> Subplots (facet)</a></li>
<li class="chapter" data-level="12.6" data-path="ggplot2.html"><a href="ggplot2.html#temas"><i class="fa fa-check"></i><b>12.6</b> Temas</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="ggplot2.html"><a href="ggplot2.html#temas-disponíveis-no-ggplot2"><i class="fa fa-check"></i><b>12.6.1</b> Temas disponíveis no ggplot2</a></li>
<li class="chapter" data-level="12.6.2" data-path="ggplot2.html"><a href="ggplot2.html#temas-no-pacote-ggthemes"><i class="fa fa-check"></i><b>12.6.2</b> Temas no pacote ggthemes</a></li>
<li class="chapter" data-level="12.6.3" data-path="ggplot2.html"><a href="ggplot2.html#setando-o-tema-globalmente"><i class="fa fa-check"></i><b>12.6.3</b> Setando o tema globalmente</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="ggplot2.html"><a href="ggplot2.html#legendas"><i class="fa fa-check"></i><b>12.7</b> Legendas</a></li>
<li class="chapter" data-level="12.8" data-path="ggplot2.html"><a href="ggplot2.html#mapas-plotando-polígonos"><i class="fa fa-check"></i><b>12.8</b> Mapas: plotando polígonos</a>
<ul>
<li class="chapter" data-level="12.8.1" data-path="ggplot2.html"><a href="ggplot2.html#projeto-plotando-indicadores-socioeconômicos-em-um-mapa."><i class="fa fa-check"></i><b>12.8.1</b> Projeto: plotando indicadores socioeconômicos em um mapa.</a></li>
</ul></li>
<li class="chapter" data-level="12.9" data-path="ggplot2.html"><a href="ggplot2.html#salvando-gráficos"><i class="fa fa-check"></i><b>12.9</b> Salvando Gráficos</a></li>
<li class="chapter" data-level="12.10" data-path="ggplot2.html"><a href="ggplot2.html#extensões-do-ggplot2"><i class="fa fa-check"></i><b>12.10</b> Extensões do ggplot2</a>
<ul>
<li class="chapter" data-level="12.10.1" data-path="ggplot2.html"><a href="ggplot2.html#ggrepel"><i class="fa fa-check"></i><b>12.10.1</b> ggrepel</a></li>
<li class="chapter" data-level="12.10.2" data-path="ggplot2.html"><a href="ggplot2.html#gganimate"><i class="fa fa-check"></i><b>12.10.2</b> gganimate</a></li>
</ul></li>
<li class="chapter" data-level="12.11" data-path="ggplot2.html"><a href="ggplot2.html#exercícios-6"><i class="fa fa-check"></i><b>12.11</b> Exercícios</a>
<ul>
<li class="chapter" data-level="12.11.1" data-path="ggplot2.html"><a href="ggplot2.html#parte-1-1"><i class="fa fa-check"></i><b>12.11.1</b> Parte 1</a></li>
<li class="chapter" data-level="12.11.2" data-path="ggplot2.html"><a href="ggplot2.html#parte-2-1"><i class="fa fa-check"></i><b>12.11.2</b> Parte 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="htmlwidgets.html"><a href="htmlwidgets.html"><i class="fa fa-check"></i><b>13</b> Visualizações Interativas</a>
<ul>
<li class="chapter" data-level="13.1" data-path="htmlwidgets.html"><a href="htmlwidgets.html#introdução-1"><i class="fa fa-check"></i><b>13.1</b> Introdução</a></li>
<li class="chapter" data-level="13.2" data-path="htmlwidgets.html"><a href="htmlwidgets.html#plotly"><i class="fa fa-check"></i><b>13.2</b> Plotly</a></li>
<li class="chapter" data-level="13.3" data-path="htmlwidgets.html"><a href="htmlwidgets.html#dygraphs"><i class="fa fa-check"></i><b>13.3</b> dygraphs</a></li>
<li class="chapter" data-level="13.4" data-path="htmlwidgets.html"><a href="htmlwidgets.html#leaflet"><i class="fa fa-check"></i><b>13.4</b> Leaflet</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="htmlwidgets.html"><a href="htmlwidgets.html#primeiro-exemplo"><i class="fa fa-check"></i><b>13.4.1</b> Primeiro exemplo</a></li>
<li class="chapter" data-level="13.4.2" data-path="htmlwidgets.html"><a href="htmlwidgets.html#marcadores"><i class="fa fa-check"></i><b>13.4.2</b> Marcadores</a></li>
<li class="chapter" data-level="13.4.3" data-path="htmlwidgets.html"><a href="htmlwidgets.html#polígonos"><i class="fa fa-check"></i><b>13.4.3</b> Polígonos</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="htmlwidgets.html"><a href="htmlwidgets.html#exercícios-7"><i class="fa fa-check"></i><b>13.5</b> Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>14</b> RMarkdown</a>
<ul>
<li class="chapter" data-level="14.1" data-path="rmarkdown.html"><a href="rmarkdown.html#usos-do-rmarkdown"><i class="fa fa-check"></i><b>14.1</b> Usos do RMarkdown</a></li>
<li class="chapter" data-level="14.2" data-path="rmarkdown.html"><a href="rmarkdown.html#estrutura-de-um-rmarkdown"><i class="fa fa-check"></i><b>14.2</b> Estrutura de um RMarkdown</a></li>
<li class="chapter" data-level="14.3" data-path="rmarkdown.html"><a href="rmarkdown.html#renderizando-um-documento"><i class="fa fa-check"></i><b>14.3</b> Renderizando um documento</a></li>
<li class="chapter" data-level="14.4" data-path="rmarkdown.html"><a href="rmarkdown.html#sintaxe"><i class="fa fa-check"></i><b>14.4</b> Sintaxe</a></li>
<li class="chapter" data-level="14.5" data-path="rmarkdown.html"><a href="rmarkdown.html#section"><i class="fa fa-check"></i><b>14.5</b> ***</a></li>
<li class="chapter" data-level="14.6" data-path="rmarkdown.html"><a href="rmarkdown.html#opções-de-chunk"><i class="fa fa-check"></i><b>14.6</b> Opções de Chunk</a></li>
<li class="chapter" data-level="14.7" data-path="rmarkdown.html"><a href="rmarkdown.html#principais-formatos"><i class="fa fa-check"></i><b>14.7</b> Principais Formatos</a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="rmarkdown.html"><a href="rmarkdown.html#html"><i class="fa fa-check"></i><b>14.7.1</b> HTML</a></li>
<li class="chapter" data-level="14.7.2" data-path="rmarkdown.html"><a href="rmarkdown.html#pdf"><i class="fa fa-check"></i><b>14.7.2</b> PDF</a></li>
<li class="chapter" data-level="14.7.3" data-path="rmarkdown.html"><a href="rmarkdown.html#word"><i class="fa fa-check"></i><b>14.7.3</b> Word</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="rmarkdown.html"><a href="rmarkdown.html#excercícios"><i class="fa fa-check"></i><b>14.8</b> Excercícios</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="modelos.html"><a href="modelos.html"><i class="fa fa-check"></i><b>15</b> Modelos</a>
<ul>
<li class="chapter" data-level="15.1" data-path="modelos.html"><a href="modelos.html#modelo-linear"><i class="fa fa-check"></i><b>15.1</b> Modelo Linear</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="modelos.html"><a href="modelos.html#regressão"><i class="fa fa-check"></i><b>15.1.1</b> Regressão</a></li>
<li class="chapter" data-level="15.1.2" data-path="modelos.html"><a href="modelos.html#classificação"><i class="fa fa-check"></i><b>15.1.2</b> Classificação</a></li>
<li class="chapter" data-level="15.1.3" data-path="modelos.html"><a href="modelos.html#classificação-com-modelos-baseados-em-árvores"><i class="fa fa-check"></i><b>15.1.3</b> Classificação com modelos baseados em árvores</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="modelos.html"><a href="modelos.html#exercícios-8"><i class="fa fa-check"></i><b>15.2</b> Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="revisão-titanic.html"><a href="revisão-titanic.html"><i class="fa fa-check"></i><b>16</b> Revisão - Titanic</a>
<ul>
<li class="chapter" data-level="16.1" data-path="revisão-titanic.html"><a href="revisão-titanic.html#objetivo"><i class="fa fa-check"></i><b>16.1</b> Objetivo</a></li>
<li class="chapter" data-level="16.2" data-path="revisão-titanic.html"><a href="revisão-titanic.html#carregando-os-dados"><i class="fa fa-check"></i><b>16.2</b> Carregando os Dados</a></li>
<li class="chapter" data-level="16.3" data-path="revisão-titanic.html"><a href="revisão-titanic.html#manipulando-os-dados-1"><i class="fa fa-check"></i><b>16.3</b> Manipulando os dados</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="revisão-titanic.html"><a href="revisão-titanic.html#variável-survived"><i class="fa fa-check"></i><b>16.3.1</b> Variável Survived</a></li>
<li class="chapter" data-level="16.3.2" data-path="revisão-titanic.html"><a href="revisão-titanic.html#variável-name"><i class="fa fa-check"></i><b>16.3.2</b> Variável Name</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="revisão-titanic.html"><a href="revisão-titanic.html#idade"><i class="fa fa-check"></i><b>16.4</b> Idade</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="revisão-titanic.html"><a href="revisão-titanic.html#exercício"><i class="fa fa-check"></i><b>16.4.1</b> Exercício</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="revisão-titanic.html"><a href="revisão-titanic.html#visualizações"><i class="fa fa-check"></i><b>16.5</b> Visualizações</a></li>
<li class="chapter" data-level="16.6" data-path="revisão-titanic.html"><a href="revisão-titanic.html#modelo-preditivo"><i class="fa fa-check"></i><b>16.6</b> Modelo Preditivo</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="referências-1.html"><a href="referências-1.html"><i class="fa fa-check"></i><b>17</b> Referências</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publicado com bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Ciência de Dados com R - Introdução</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplot2" class="section level1" number="12">
<h1><span class="header-section-number">12</span> Visualizações de dados (ggplot2)</h1>
<p>Pacotes deste capítulo:</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="ggplot2.html#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb484-2"><a href="ggplot2.html#cb484-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb484-3"><a href="ggplot2.html#cb484-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb484-4"><a href="ggplot2.html#cb484-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb484-5"><a href="ggplot2.html#cb484-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb484-6"><a href="ggplot2.html#cb484-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb484-7"><a href="ggplot2.html#cb484-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geobr)</span>
<span id="cb484-8"><a href="ggplot2.html#cb484-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl) </span>
<span id="cb484-9"><a href="ggplot2.html#cb484-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb484-10"><a href="ggplot2.html#cb484-10" aria-hidden="true" tabindex="-1"></a><span class="co"># novos: </span></span>
<span id="cb484-11"><a href="ggplot2.html#cb484-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb484-12"><a href="ggplot2.html#cb484-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(countrycode)</span>
<span id="cb484-13"><a href="ggplot2.html#cb484-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb484-14"><a href="ggplot2.html#cb484-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wpp2019)</span>
<span id="cb484-15"><a href="ggplot2.html#cb484-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rbcb) <span class="co"># remotes::install_github(&#39;wilsonfreitas/rbcb&#39;)</span></span></code></pre></div>
<p>O <code>ggplot2</code> é mais um pacote desenvolvido por Hadley Wickham, o criador, por exemplo, do <code>tidyr</code> e do <code>dplyr</code>. A ideia do pacote, ainda que com algumas modificações, vem de uma obra chamada <a href="https://www.amazon.com/Grammar-Graphics-Statistics-Computing/dp/0387245448"><em>The Grammar of Graphics</em></a>, que é uma maneira de descrever um gráfico a partir dos seus componentes. Dessa forma, teoricamente, ficaria mais fácil entender a construção de gráficos mais complexos.</p>
<p>Esse pacote é estruturado de forma que a “gramática” seja utilizada para um gráfico a partir de múltiplas camadas. As camadas serão formadas por dados, mapeamentos estéticos, transformações estatísticas dos dados, objetos geométricos (pontos, linhas, barras etc.) e ajuste de posicionamento. Além disso, existem outros componentes, como os sistemas de coordenadas (cartesiano, polar, mapa etc.) e, se for o caso, divisões do gráfico em subplots (<em>facet</em>). Um simples exemplo de múltiplas camadas seria um gráfico de pontos adicionado de uma curva de ajustamento.</p>
<p>Uma forma geral (template) para entender-se a estrutura do ggplot2, segundo o próprio Hadley Wickhan, no livro <a href="http://r4ds.had.co.nz/data-visualisation.html#the-layered-grammar-of-graphics">R for Data Science</a>, é a seguinte:</p>
<pre><code>ggplot(data = &lt;DATA&gt;) + 
  &lt;GEOM_FUNCTION&gt;(
     mapping = aes(&lt;MAPPINGS&gt;),
     stat = &lt;STAT&gt;, 
     position = &lt;POSITION&gt;
  ) +
  &lt;COORDINATE_FUNCTION&gt; +
  &lt;FACET_FUNCTION&gt; # dividir o gráfico em subplots</code></pre>
<p>A ideia é que todo gráfico pode ser representado por essa forma. No entanto, na criação de um gráfico, não é necessário especificar-se todas as partes acima. O ggplot2 já oferece um padrão para o sistema de coordenadas, para o <code>stat</code> e <code>position</code>. O <code>facet</code> (subplot) só será utilizado quando necessário.</p>
<p>Além disso, existem as escalas que são utilizadas para controlar o mapeamento dos dados em relação aos atributos estéticos do gráfico. Por exemplo: suponha que no seu gráfico exista uma coluna que é uma variável categórica com três classes possíveis e as cores do objeto geométrico estejam associadas a essa variável. Automaticamente, o ggplot2 definirá uma cor pra cada classe. No entanto, você pode alterar a escala de cores para ter controle sobre elas. O mesmo vale para os valores apresentados nos eixos x e y.</p>
<p>Uma observação importante é que apesar dos dados estarem na função <code>ggplot()</code> (<code>&lt;DATA&gt;</code>), eles também podem ser incluídos diretamente em cada objeto geométrico. Isto será útil quando for necessário criar-se uma nova camada a partir de dados diferentes daqueles que estão inicialmente nos gráficos.</p>
<p>Dessa forma, incorporando essas observações, um template estendido seria o abaixo:</p>
<pre><code>ggplot(data = &lt;DATA&gt;) + 
  &lt;GEOM_FUNCTION&gt;(
     mapping = aes(&lt;MAPPINGS&gt;),
     stat = &lt;STAT&gt;, 
     position = &lt;POSITION&gt;,
     data = &lt;DATA&gt; # pode receber os dados diretamente
  ) +
  &lt;SCALE_FUNCTION&gt; + # uma para cada elemento estético
  &lt;COORDINATE_FUNCTION&gt; +
  &lt;FACET_FUNCTION&gt; # dividir o gráfico em subplots</code></pre>
<p>Também é importante ressaltar-se que, como todo sistema de gráficos, é possível alterar-se todos os títulos e rótulos do gráfico, além do controle sobre as características do tema do gráfico (cor do fundo, estilo da fonte, tamanho da fonte etc).</p>
<div id="dataset-do-módulo" class="section level2" number="12.1">
<h2><span class="header-section-number">12.1</span> Dataset do módulo</h2>
<p>Para este módulo, usaremos o dataset <strong>World Happiness Report</strong>, ou o Relatório Mundial da Felicidade, que é uma medição da felicidade publicado pela Rede de Soluções para o Desenvolvimento Sustentável da ONU (SDSN, na sigla em inglês). Leia o <a href="https://pt.wikipedia.org/wiki/Relat%C3%B3rio_Mundial_da_Felicidade">artigo na Wikipedia</a> para mais informações.</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="ggplot2.html#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="co"># baixe o arquivo do endereco:</span></span>
<span id="cb487-2"><a href="ggplot2.html#cb487-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;https://s3.amazonaws.com/happiness-report/2018/WHR2018Chapter2OnlineData.xls&quot;</span>,</span>
<span id="cb487-3"><a href="ggplot2.html#cb487-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> <span class="st">&quot;felicidade.xls&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="ggplot2.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importar a planilha</span></span>
<span id="cb488-2"><a href="ggplot2.html#cb488-2" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;felicidade.xls&quot;</span>, <span class="at">sheet =</span> <span class="dv">1</span>)</span>
<span id="cb488-3"><a href="ggplot2.html#cb488-3" aria-hidden="true" tabindex="-1"></a><span class="co"># limpar o nome das colunas</span></span>
<span id="cb488-4"><a href="ggplot2.html#cb488-4" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(df_feliz)</span>
<span id="cb488-5"><a href="ggplot2.html#cb488-5" aria-hidden="true" tabindex="-1"></a><span class="co"># renomear algumas colunas</span></span>
<span id="cb488-6"><a href="ggplot2.html#cb488-6" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="ot">&lt;-</span> df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb488-7"><a href="ggplot2.html#cb488-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">life_expec =</span> healthy_life_expectancy_at_birth)</span>
<span id="cb488-8"><a href="ggplot2.html#cb488-8" aria-hidden="true" tabindex="-1"></a><span class="co"># olhar dados </span></span>
<span id="cb488-9"><a href="ggplot2.html#cb488-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df_feliz)</span></code></pre></div>
<pre><code>## Rows: 1,562
## Columns: 19
## $ country                                                 &lt;chr&gt; &quot;Afghanistan&quot;, &quot;Afghanistan&quot;, &quot;Afghanistan&quot;, &quot;Afghanistan&quot;, &quot;Afg…
## $ year                                                    &lt;dbl&gt; 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2007…
## $ life_ladder                                             &lt;dbl&gt; 3.723590, 4.401778, 4.758381, 3.831719, 3.782938, 3.572100, 3.13…
## $ log_gdp_per_capita                                      &lt;dbl&gt; 7.168690, 7.333790, 7.386629, 7.415019, 7.517126, 7.503376, 7.48…
## $ social_support                                          &lt;dbl&gt; 0.4506623, 0.5523084, 0.5390752, 0.5211036, 0.5206367, 0.4835519…
## $ life_expec                                              &lt;dbl&gt; 49.20966, 49.62443, 50.00896, 50.36730, 50.70926, 51.04298, 51.3…
## $ freedom_to_make_life_choices                            &lt;dbl&gt; 0.7181143, 0.6788964, 0.6001272, 0.4959014, 0.5309350, 0.5779554…
## $ generosity                                              &lt;dbl&gt; 0.18181947, 0.20361446, 0.13763019, 0.17532922, 0.24715924, 0.07…
## $ perceptions_of_corruption                               &lt;dbl&gt; 0.8816863, 0.8500354, 0.7067661, 0.7311085, 0.7756198, 0.8232041…
## $ positive_affect                                         &lt;dbl&gt; 0.5176372, 0.5839256, 0.6182655, 0.6113873, 0.7103847, 0.6205848…
## $ negative_affect                                         &lt;dbl&gt; 0.2581955, 0.2370924, 0.2753238, 0.2671747, 0.2679191, 0.2733281…
## $ confidence_in_national_government                       &lt;dbl&gt; 0.6120721, 0.6115452, 0.2993574, 0.3073857, 0.4354402, 0.4828473…
## $ democratic_quality                                      &lt;dbl&gt; -1.92968953, -2.04409266, -1.99180996, -1.91901839, -1.84299576,…
## $ delivery_quality                                        &lt;dbl&gt; -1.6550844, -1.6350248, -1.6171761, -1.6162212, -1.4040775, -1.4…
## $ standard_deviation_of_ladder_by_country_year            &lt;dbl&gt; 1.774662, 1.722688, 1.878622, 1.785360, 1.798283, 1.223690, 1.39…
## $ standard_deviation_mean_of_ladder_by_country_year       &lt;dbl&gt; 0.4765997, 0.3913617, 0.3948027, 0.4659422, 0.4753669, 0.3425687…
## $ gini_index_world_bank_estimate                          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 0.290, N…
## $ gini_index_world_bank_estimate_average_2000_15          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 0.3032500, 0.3032500, 0.…
## $ gini_of_household_income_reported_in_gallup_by_wp5_year &lt;dbl&gt; NA, 0.4419058, 0.3273182, 0.3367642, 0.3445396, 0.3043685, 0.413…</code></pre>
<p>Sentiram falta de uma coluna com o nome do continente? Vamos também importar um dataset que contém o continente de cada país, fornecido pelo pacote <code>countrycode</code>.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="ggplot2.html#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="co"># consertar manualmente os nomes de certos paises</span></span>
<span id="cb490-2"><a href="ggplot2.html#cb490-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-3"><a href="ggplot2.html#cb490-3" aria-hidden="true" tabindex="-1"></a>df_feliz<span class="sc">$</span>country[df_feliz<span class="sc">$</span>country <span class="sc">==</span> <span class="st">&quot;Bosnia and Herzegovina&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Bosnia &amp; Herzegovina&quot;</span></span>
<span id="cb490-4"><a href="ggplot2.html#cb490-4" aria-hidden="true" tabindex="-1"></a>df_feliz<span class="sc">$</span>country[df_feliz<span class="sc">$</span>country <span class="sc">==</span> <span class="st">&quot;Czech Republic&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Czechia&quot;</span></span>
<span id="cb490-5"><a href="ggplot2.html#cb490-5" aria-hidden="true" tabindex="-1"></a>df_feliz<span class="sc">$</span>country[df_feliz<span class="sc">$</span>country <span class="sc">==</span> <span class="st">&quot;Hong Kong S.A.R. of China&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Czechia&quot;</span></span>
<span id="cb490-6"><a href="ggplot2.html#cb490-6" aria-hidden="true" tabindex="-1"></a>df_feliz<span class="sc">$</span>country[df_feliz<span class="sc">$</span>country <span class="sc">==</span> <span class="st">&quot;Taiwan Province of China&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Taiwan&quot;</span></span>
<span id="cb490-7"><a href="ggplot2.html#cb490-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-8"><a href="ggplot2.html#cb490-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-9"><a href="ggplot2.html#cb490-9" aria-hidden="true" tabindex="-1"></a><span class="co"># consulte a documentação do dataset</span></span>
<span id="cb490-10"><a href="ggplot2.html#cb490-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ?countrycode::codelist </span></span>
<span id="cb490-11"><a href="ggplot2.html#cb490-11" aria-hidden="true" tabindex="-1"></a>df_continente <span class="ot">&lt;-</span> countrycode<span class="sc">::</span>codelist  <span class="sc">%&gt;%</span> </span>
<span id="cb490-12"><a href="ggplot2.html#cb490-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># selecionar colunas importantes</span></span>
<span id="cb490-13"><a href="ggplot2.html#cb490-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">country =</span> country.name.en, continent, <span class="at">country_code =</span> iso3n) <span class="sc">%&gt;%</span> </span>
<span id="cb490-14"><a href="ggplot2.html#cb490-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filtrar fora os paises sem continentes</span></span>
<span id="cb490-15"><a href="ggplot2.html#cb490-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(continent))</span>
<span id="cb490-16"><a href="ggplot2.html#cb490-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-17"><a href="ggplot2.html#cb490-17" aria-hidden="true" tabindex="-1"></a><span class="co"># criar dataframe com juncao dos dois</span></span>
<span id="cb490-18"><a href="ggplot2.html#cb490-18" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(df_feliz, df_continente, <span class="at">by =</span> <span class="st">&quot;country&quot;</span>)</span>
<span id="cb490-19"><a href="ggplot2.html#cb490-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-20"><a href="ggplot2.html#cb490-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-21"><a href="ggplot2.html#cb490-21" aria-hidden="true" tabindex="-1"></a><span class="co"># coletar dados de populacao a partir de outro dataset, do pacote wpp2019</span></span>
<span id="cb490-22"><a href="ggplot2.html#cb490-22" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(pop)</span>
<span id="cb490-23"><a href="ggplot2.html#cb490-23" aria-hidden="true" tabindex="-1"></a>df_populacao <span class="ot">&lt;-</span> pop <span class="sc">%&gt;%</span> </span>
<span id="cb490-24"><a href="ggplot2.html#cb490-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country_code, <span class="st">`</span><span class="at">2020</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb490-25"><a href="ggplot2.html#cb490-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">populacao_2020 =</span> <span class="dv">2</span>)</span>
<span id="cb490-26"><a href="ggplot2.html#cb490-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-27"><a href="ggplot2.html#cb490-27" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="ot">&lt;-</span> df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb490-28"><a href="ggplot2.html#cb490-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_populacao, <span class="at">by =</span> <span class="st">&#39;country_code&#39;</span>)</span>
<span id="cb490-29"><a href="ggplot2.html#cb490-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-30"><a href="ggplot2.html#cb490-30" aria-hidden="true" tabindex="-1"></a><span class="co"># criar dataset apenas para o ano mais recente</span></span>
<span id="cb490-31"><a href="ggplot2.html#cb490-31" aria-hidden="true" tabindex="-1"></a>df_2017 <span class="ot">&lt;-</span> df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb490-32"><a href="ggplot2.html#cb490-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">max</span>(year))</span></code></pre></div>
<p>Para quebrar-se a barreira inicial, vamos criar um exemplo por partes de um gráfico do PIB per capita e da expectativa de vida dos países em 2017:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="ggplot2.html#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inicia o plot</span></span>
<span id="cb491-2"><a href="ggplot2.html#cb491-2" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_2017)</span>
<span id="cb491-3"><a href="ggplot2.html#cb491-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-4"><a href="ggplot2.html#cb491-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar pontos (geom_point) e</span></span>
<span id="cb491-5"><a href="ggplot2.html#cb491-5" aria-hidden="true" tabindex="-1"></a><span class="co"># vamos mapear variáveis a elementos estéticos dos pontos</span></span>
<span id="cb491-6"><a href="ggplot2.html#cb491-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Size = 3 define o tamanho de todos os pontos</span></span>
<span id="cb491-7"><a href="ggplot2.html#cb491-7" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> g <span class="sc">+</span></span>
<span id="cb491-8"><a href="ggplot2.html#cb491-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita,</span>
<span id="cb491-9"><a href="ggplot2.html#cb491-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> life_expec,</span>
<span id="cb491-10"><a href="ggplot2.html#cb491-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> continent),</span>
<span id="cb491-11"><a href="ggplot2.html#cb491-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>)</span>
<span id="cb491-12"><a href="ggplot2.html#cb491-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-13"><a href="ggplot2.html#cb491-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Rótulos (títulos)</span></span>
<span id="cb491-14"><a href="ggplot2.html#cb491-14" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> g <span class="sc">+</span></span>
<span id="cb491-15"><a href="ggplot2.html#cb491-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&#39;Relação entre PIB per capita e expectativa de vida&#39;</span>,</span>
<span id="cb491-16"><a href="ggplot2.html#cb491-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Anos&#39;</span>,</span>
<span id="cb491-17"><a href="ggplot2.html#cb491-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&#39;USD/pessoa&#39;</span>)</span>
<span id="cb491-18"><a href="ggplot2.html#cb491-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-19"><a href="ggplot2.html#cb491-19" aria-hidden="true" tabindex="-1"></a>g</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-6-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Detalharemos cada parte do gráfico, mas vale falar-se rapidamente sobre o código acima. Primeiramente, passamos um conjunto de dados para o ggplot. Depois, adicionamos uma camada de pontos, mapeando as variáveis <code>log_gdp_per_capita</code> e <code>life_expec</code> para as posições de cada ponto nos eixos <code>x</code> e <code>y</code>, respectivamente, e a variável <code>continent</code> para a cor de cada ponto. Em seguida, alteramos a escala de cor, definindo seu título, os rótulos (<code>labels</code>) e os valores (<code>values</code>) para as cores. Por fim, definimos os títulos/rótulos do gráfico.</p>
<p>Nas próximas seções, falaremos com mais detalhes sobre cada componente, começando pelo mapeamento estético.</p>
</div>
<div id="mapeamento-estético" class="section level2" number="12.2">
<h2><span class="header-section-number">12.2</span> Mapeamento Estético</h2>
<p>O mapeamento estético é o mapeamento das variáveis dos dados para as características visuais dos objetos geométricos (pontos, barras, linhas etc.). Isto é feito a partir da função <code>aes()</code>. E quais são as características visuais de um objeto geométrico? Abaixo segue uma lista não exaustiva:</p>
<ul>
<li>Posição (<code>x</code> e <code>y</code>);</li>
<li>Cor (<code>color</code>);</li>
<li>Tamanho (<code>size</code>);</li>
<li>Preenchimento (<code>fill</code>);</li>
<li>Transparência (<code>alpha</code>);</li>
<li>Texto (<code>label</code>).</li>
</ul>
<p>Como vimos no exemplo acima, mapeamos três variáveis para três características visuais de cada ponto: posição <code>x</code>, posição <code>y</code> e cor. Nos próximos exemplos, outros elementos estéticos serão utilizados, conforme o objeto geométrico selecionado.</p>
</div>
<div id="objetos-geométricos-e-tipos-de-gráficos" class="section level2" number="12.3">
<h2><span class="header-section-number">12.3</span> Objetos geométricos e tipos de gráficos</h2>
<p>Os objetos geométricos começam com a expressão <code>geom_</code> e são seguidos pelo tipo de objeto. Por exemplo, <code>geom_point()</code> para pontos e <code>geom_bar()</code> para barras. A tabela abaixo apresenta os tipos de objetos geométricos utilizados para criar-se alguns tipos de gráficos populares.</p>
<table>
<thead>
<tr class="header">
<th align="center">Tipo</th>
<th align="center">Objeto Geométrico</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Dispersão (scatterplot)</td>
<td align="center"><code>geom_point()</code></td>
</tr>
<tr class="even">
<td align="center">Gráfico de bolhas</td>
<td align="center"><code>geom_point()</code></td>
</tr>
<tr class="odd">
<td align="center">Gráfico de barras</td>
<td align="center"><code>geom_col()</code> e <code>geom_bar()</code></td>
</tr>
<tr class="even">
<td align="center">Histograma</td>
<td align="center"><code>geom_histogram()</code></td>
</tr>
<tr class="odd">
<td align="center">Boxplot</td>
<td align="center"><code>geom_boxplot()</code></td>
</tr>
<tr class="even">
<td align="center">Densidade</td>
<td align="center"><code>geom_density()</code></td>
</tr>
<tr class="odd">
<td align="center">Gráfico de linhas</td>
<td align="center"><code>geom_line()</code></td>
</tr>
</tbody>
</table>
<p>Nesse material, os principais tipos de objetos geométricos serão demonstrados a partir de exemplos. A lista completa de objetos geométricos e as descrições dos argumentos estão na <a href="http://ggplot2.tidyverse.org/">documentação</a> do <code>ggplot2</code>.</p>
<p>É importante saber-se que um gráfico do ggplot2 pode ter mais de um objeto geométrico, cada um formando uma camada. Por exemplo, uma camada de pontos e outra de linhas que conectam os pontos.</p>
<p>Vamos, primeiramente, criar um gráfico com pontos:</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="ggplot2.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_2017, <span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita,</span>
<span id="cb493-2"><a href="ggplot2.html#cb493-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb493-3"><a href="ggplot2.html#cb493-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-7-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Note que o <code>aes()</code> está sendo usado diretamente na função <code>ggplot()</code> e não no objeto geométrico. O que isto significa? Que o mapeamento estético definido na função <code>ggplot()</code> é global. Ou seja, é aplicado para todos os objetos geométricos daquele gráfico, a menos que seja explicitado novamente em alguma camada.</p>
<p>Para finalizarmos essa breve introdução a objetos geométricos, adicionemos mais uma camada ao gráfico:</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="ggplot2.html#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_2017, <span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita,</span>
<span id="cb494-2"><a href="ggplot2.html#cb494-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb494-3"><a href="ggplot2.html#cb494-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb494-4"><a href="ggplot2.html#cb494-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-8-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>No exemplo acima, também não foi necessário definir os mapeamentos estéticos da camada <code>geom_smooth()</code>, pois eles foram herdados das definições da camada principal, a <code>ggplot()</code>. O que aconteceria, no entanto, caso fosse desejado pintar as cores de cada ponto de acordo com alguma variável, como o continente do país?</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="ggplot2.html#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_2017, <span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita,</span>
<span id="cb495-2"><a href="ggplot2.html#cb495-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> life_expec,</span>
<span id="cb495-3"><a href="ggplot2.html#cb495-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> continent)) <span class="sc">+</span></span>
<span id="cb495-4"><a href="ggplot2.html#cb495-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb495-5"><a href="ggplot2.html#cb495-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-9-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Note que a camada <code>geom_smooth()</code> herdou o mapeamento <code>color</code>, de forma que foi criada uma reta de ajuste para cada continente. Isso pode até ser desejável, mas e se o objetivo for destacar a cor apenas dos pontos, mantendo apenas uma reta de ajuste para todos os continentes?</p>
<p>Seria necessário então alterar o atributor <code>color</code> apenas da camada alvo.</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="ggplot2.html#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_2017, <span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita,</span>
<span id="cb496-2"><a href="ggplot2.html#cb496-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb496-3"><a href="ggplot2.html#cb496-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> continent)) <span class="sc">+</span></span>
<span id="cb496-4"><a href="ggplot2.html#cb496-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-10-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div id="escolhendo-o-tipo-de-gráfico" class="section level3" number="12.3.1">
<h3><span class="header-section-number">12.3.1</span> Escolhendo o tipo de gráfico</h3>
<p>Antes de decidir qual gráfico você utilizará, é preciso saber o que se deseja representar. O objetivo guiará o tipo de gráfico mais adequado. A imagem abaixo apresenta uma lista bastante completa de possibilidades de gráficos, dos mais simples aos mais complexos:</p>
<p><img src="images/tipo_graficos.png" /></p>
<p>Entre <a href="https://camo.githubusercontent.com/ea2e9eda9b01fafc1213f5c400aa357584f40df8/687474703a2f2f626c6f672e76697375616c2e6c792f77702d636f6e74656e742f75706c6f6164732f323031342f30392f696d6167652d362e706e67">neste link</a> para visualizar a imagem com zoom.</p>
</div>
<div id="gráfico-de-dispersão-geom_point" class="section level3" number="12.3.2">
<h3><span class="header-section-number">12.3.2</span> Gráfico de Dispersão (<code>geom_point()</code>)</h3>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="ggplot2.html#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="cn">NULL</span>, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb497-2"><a href="ggplot2.html#cb497-2" aria-hidden="true" tabindex="-1"></a>           ..., <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">NA</span>, <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>O gráfico de dispersão é bastante usado para verificar-se relações entre duas variáveis quantitativas.</p>
<p>Como queremos um gráfico de pontos, o objeto geométrico natural é o <code>geom_point()</code>. Esse objeto geométrico tem os seguintes elementos estéticos:</p>
<p>Os parâmetros estéticos (aes) são:</p>
<ul>
<li><strong><code>x</code></strong></li>
<li><strong><code>y</code></strong></li>
<li><code>alpha</code></li>
<li><code>colour</code></li>
<li><code>fill</code></li>
<li><code>shape</code></li>
<li><code>size</code></li>
<li><code>stroke</code></li>
</ul>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="ggplot2.html#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_2017, <span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita, </span>
<span id="cb498-2"><a href="ggplot2.html#cb498-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb498-3"><a href="ggplot2.html#cb498-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-12-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Vamos mapear a variável <code>continent</code> ao elemento estético color e shape:</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="ggplot2.html#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_2017, <span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita, </span>
<span id="cb500-2"><a href="ggplot2.html#cb500-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb500-3"><a href="ggplot2.html#cb500-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> continent,</span>
<span id="cb500-4"><a href="ggplot2.html#cb500-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">shape =</span> continent))</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-13-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Automaticamente o ggplot2 criou uma escala para as cores e formatos dos pontos. O usuário pode alterar este mapeamento utilizando as funções <code>scale_*_*</code>.</p>
<p>Por fim, fica aqui a lista com os tipos de shapes:</p>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-14-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Perceba que os formatos de 21 a 24 possuem preenchimento (<code>fill</code>). Assim, no código abaixo definiremos o preenchimento, o tamanho do ponto e a espessura para aqueles formatos que possuem contornos.</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="ggplot2.html#cb502-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_2017, <span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita, </span>
<span id="cb502-2"><a href="ggplot2.html#cb502-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb502-3"><a href="ggplot2.html#cb502-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> continent,</span>
<span id="cb502-4"><a href="ggplot2.html#cb502-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">shape =</span> continent,</span>
<span id="cb502-5"><a href="ggplot2.html#cb502-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> continent)) <span class="sc">+</span></span>
<span id="cb502-6"><a href="ggplot2.html#cb502-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_color_discrete(&quot;Continente&quot;) +</span></span>
<span id="cb502-7"><a href="ggplot2.html#cb502-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="st">&quot;Continente&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">23</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb502-8"><a href="ggplot2.html#cb502-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Relação entre Renda per Capita e Expectativa de Vida - 2007&quot;</span>,</span>
<span id="cb502-9"><a href="ggplot2.html#cb502-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Renda per Capita (escala log 10)&quot;</span>,</span>
<span id="cb502-10"><a href="ggplot2.html#cb502-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Expectativa de Vida&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-15-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="gráficos-de-bolhas" class="section level3" number="12.3.3">
<h3><span class="header-section-number">12.3.3</span> Gráficos de Bolhas</h3>
<p>O gráfico de bolha é uma extensão natural do gráfico de pontos. Ele permite observar-se possíveis relações entre as três variáveis. Para este tipo de gráfico, são necessárias três variáveis: duas para indicarem as posições x e y e uma terceira para definir o tamanho do ponto (<code>size</code>). Vamos utilizar a variável <code>populacao_2020</code> (população):</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="ggplot2.html#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df_2017)</span></code></pre></div>
<pre><code>## Rows: 134
## Columns: 22
## $ country                                                 &lt;chr&gt; &quot;Afghanistan&quot;, &quot;Albania&quot;, &quot;Algeria&quot;, &quot;Argentina&quot;, &quot;Armenia&quot;, &quot;Au…
## $ year                                                    &lt;dbl&gt; 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017…
## $ life_ladder                                             &lt;dbl&gt; 2.661718, 4.639548, 5.248912, 6.039330, 4.287736, 7.257038, 7.29…
## $ log_gdp_per_capita                                      &lt;dbl&gt; 7.460144, 9.373718, 9.540244, 9.843519, 9.034711, 10.711827, 10.…
## $ social_support                                          &lt;dbl&gt; 0.4908801, 0.6376983, 0.8067539, 0.9066991, 0.6979249, 0.9499578…
## $ life_expec                                              &lt;dbl&gt; 52.33953, 69.05166, 65.69919, 67.53870, 65.12569, 72.78334, 72.3…
## $ freedom_to_make_life_choices                            &lt;dbl&gt; 0.4270109, 0.7496110, 0.4366705, 0.8319662, 0.6136971, 0.9105502…
## $ generosity                                              &lt;dbl&gt; -0.106340349, -0.035140377, -0.194670126, -0.186299905, -0.13216…
## $ perceptions_of_corruption                               &lt;dbl&gt; 0.9543926, 0.8761346, 0.6997742, 0.8410525, 0.8646833, 0.4113465…
## $ positive_affect                                         &lt;dbl&gt; 0.4963486, 0.6692409, 0.6419796, 0.8094226, 0.6250138, 0.7800789…
## $ negative_affect                                         &lt;dbl&gt; 0.3713262, 0.3338841, 0.2887100, 0.2917173, 0.4371487, 0.2253610…
## $ confidence_in_national_government                       &lt;dbl&gt; 0.2611785, 0.4577375, NA, 0.3054303, 0.2469010, 0.4534070, 0.435…
## $ democratic_quality                                      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ delivery_quality                                        &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ standard_deviation_of_ladder_by_country_year            &lt;dbl&gt; 1.454051, 2.682105, 2.039765, 2.409329, 2.325379, 1.745699, 1.56…
## $ standard_deviation_mean_of_ladder_by_country_year       &lt;dbl&gt; 0.5462828, 0.5780961, 0.3886071, 0.3989398, 0.5423325, 0.2405526…
## $ gini_index_world_bank_estimate                          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ gini_index_world_bank_estimate_average_2000_15          &lt;dbl&gt; NA, 0.3032500, 0.2760000, 0.4760667, 0.3250667, 0.3427500, 0.303…
## $ gini_of_household_income_reported_in_gallup_by_wp5_year &lt;dbl&gt; 0.2865989, 0.4104880, 0.5275558, 0.3941758, 0.4788766, 0.4283409…
## $ continent                                               &lt;chr&gt; &quot;Asia&quot;, &quot;Europe&quot;, &quot;Africa&quot;, &quot;Americas&quot;, &quot;Asia&quot;, &quot;Oceania&quot;, &quot;Euro…
## $ country_code                                            &lt;dbl&gt; 4, 8, 12, 32, 51, 36, 40, 31, 48, 50, 112, 56, 204, 68, 70, 72, …
## $ populacao_2020                                          &lt;dbl&gt; 38928.341, 2877.800, 43851.043, 45195.777, 2963.234, 25499.881, …</code></pre>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="ggplot2.html#cb506-1" aria-hidden="true" tabindex="-1"></a>df_2017 <span class="sc">%&gt;%</span> </span>
<span id="cb506-2"><a href="ggplot2.html#cb506-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita,</span>
<span id="cb506-3"><a href="ggplot2.html#cb506-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> life_expec, </span>
<span id="cb506-4"><a href="ggplot2.html#cb506-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> populacao_2020)) <span class="sc">+</span></span>
<span id="cb506-5"><a href="ggplot2.html#cb506-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb506-6"><a href="ggplot2.html#cb506-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Relação entre Renda per Capita e Expectativa de Vida - 2007&quot;</span>,</span>
<span id="cb506-7"><a href="ggplot2.html#cb506-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Renda per Capita (escala log 10)&quot;</span>,</span>
<span id="cb506-8"><a href="ggplot2.html#cb506-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Expectativa de Vida&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-17-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="gráficos-de-barras" class="section level3" number="12.3.4">
<h3><span class="header-section-number">12.3.4</span> Gráficos de Barras</h3>
<p>Os gráficos de barras/colunas são geralmente utilizados para comparações entre categorias (variáveis qualitativas). No ggplot2 podemos usar dois objetos geométricos distintos:</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="ggplot2.html#cb508-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_col</span>(<span class="at">mapping =</span> <span class="cn">NULL</span>, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, ...,</span>
<span id="cb508-2"><a href="ggplot2.html#cb508-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="cn">NULL</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">NA</span>, <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Os parâmetros estéticos (aes) são:</p>
<ul>
<li><strong><code>x</code></strong><br />
</li>
<li><strong><code>y</code></strong><br />
</li>
<li><code>alpha</code></li>
<li><code>colour</code></li>
<li><code>fill</code></li>
<li><code>linetype</code></li>
<li><code>size</code></li>
</ul>
<p>No exemplo do dataset, um gráfico de barras é uma boa opção para calcular a população total por continente:</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="ggplot2.html#cb509-1" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb509-2"><a href="ggplot2.html#cb509-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb509-3"><a href="ggplot2.html#cb509-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pop_total =</span> <span class="fu">sum</span>(populacao_2020)) <span class="sc">%&gt;%</span> </span>
<span id="cb509-4"><a href="ggplot2.html#cb509-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> continent, <span class="at">y =</span> pop_total)) <span class="sc">+</span></span>
<span id="cb509-5"><a href="ggplot2.html#cb509-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-19-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Uma pergunta recorrente é: Como ordenar as barras em ordem crescente/decrescente? Para isso, pode-se utilizar a função <code>fct_reorder()</code> no momento do mapeamento. Fica mais claro com um exemplo:</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="ggplot2.html#cb510-1" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb510-2"><a href="ggplot2.html#cb510-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb510-3"><a href="ggplot2.html#cb510-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pop_total =</span> <span class="fu">sum</span>(populacao_2020)) <span class="sc">%&gt;%</span> </span>
<span id="cb510-4"><a href="ggplot2.html#cb510-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(continent, pop_total),</span>
<span id="cb510-5"><a href="ggplot2.html#cb510-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> pop_total)) <span class="sc">+</span></span>
<span id="cb510-6"><a href="ggplot2.html#cb510-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-20-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Vamos, agora, criar um gráfico em que se compara a expectativa de vida média por continente em no menor e no maior ano da série temporal:</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="ggplot2.html#cb511-1" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb511-2"><a href="ggplot2.html#cb511-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2010</span>, <span class="dv">2017</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb511-3"><a href="ggplot2.html#cb511-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Converte o ano para factor - será categoria no gráfico</span></span>
<span id="cb511-4"><a href="ggplot2.html#cb511-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.character</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb511-5"><a href="ggplot2.html#cb511-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span> </span>
<span id="cb511-6"><a href="ggplot2.html#cb511-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">life_expec_media =</span> <span class="fu">mean</span>(life_expec)) <span class="sc">%&gt;%</span> </span>
<span id="cb511-7"><a href="ggplot2.html#cb511-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> continent, <span class="at">y =</span> life_expec_media, <span class="at">fill =</span> year)) <span class="sc">+</span></span>
<span id="cb511-8"><a href="ggplot2.html#cb511-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;continent&#39;. You can override using the `.groups` argument.</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-21-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Para continente, o gráfico empilhou as barras. Isto se deve ao argumento <code>position = stack</code>. Para colocar as barras lado a lado, utilizamos o valor “dodge”:</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="ggplot2.html#cb513-1" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb513-2"><a href="ggplot2.html#cb513-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2010</span>, <span class="dv">2017</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb513-3"><a href="ggplot2.html#cb513-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Converte o ano para factor - será categoria no gráfico</span></span>
<span id="cb513-4"><a href="ggplot2.html#cb513-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.character</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb513-5"><a href="ggplot2.html#cb513-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span> </span>
<span id="cb513-6"><a href="ggplot2.html#cb513-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">life_expec_media =</span> <span class="fu">mean</span>(life_expec)) <span class="sc">%&gt;%</span> </span>
<span id="cb513-7"><a href="ggplot2.html#cb513-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> continent, <span class="at">y =</span> life_expec_media, <span class="at">fill =</span> year)) <span class="sc">+</span></span>
<span id="cb513-8"><a href="ggplot2.html#cb513-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;continent&#39;. You can override using the `.groups` argument.</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-22-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="gráficos-de-linhas" class="section level3" number="12.3.5">
<h3><span class="header-section-number">12.3.5</span> Gráficos de linhas</h3>
<p>Os gráficos de linhas são, geralmente, utilizados para apresentar-se a evolução de uma variável quantitativa em um intervalo de tempo.</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="ggplot2.html#cb515-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="cn">NULL</span>, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb515-2"><a href="ggplot2.html#cb515-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">NA</span>, <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>, ...)</span></code></pre></div>
<p>Os parâmetros estéticos (aes) são:</p>
<ul>
<li><strong><code>x</code></strong></li>
<li><strong><code>y</code></strong></li>
<li><code>alpha</code></li>
<li><code>colour</code></li>
<li><code>linetype</code></li>
<li><code>size</code></li>
</ul>
<p>Série temporal é definida como uma variável contínua mensurada em intervalos regulares de tempo. A melhor representação visual para dados desse tipo são gráficos de linha, que são úteis para mostrar o comportamento de uma variável ao longo do tempo.</p>
<p>Como exemplo para gráficos de linha, vamos plotar a evolução de dois importantes indicadores econômicos brasileiros: a taxa SELIC e o índice IPCA, ambos mensalizados. Para obter esses indicadores, usamos o pacote <code>rbcb</code>:</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="ggplot2.html#cb516-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importar para o R dados das series.</span></span>
<span id="cb516-2"><a href="ggplot2.html#cb516-2" aria-hidden="true" tabindex="-1"></a>lista_datasets <span class="ot">&lt;-</span> rbcb<span class="sc">::</span><span class="fu">get_series</span>(<span class="at">code =</span> <span class="fu">c</span>(<span class="at">ipca =</span> <span class="dv">433</span>, <span class="at">selic =</span> <span class="dv">4390</span>))</span>
<span id="cb516-3"><a href="ggplot2.html#cb516-3" aria-hidden="true" tabindex="-1"></a><span class="co"># O objeto retornado é uma lista de dois dataframes:</span></span>
<span id="cb516-4"><a href="ggplot2.html#cb516-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(lista_datasets)</span></code></pre></div>
<pre><code>## List of 2
##  $ ipca : tibble [486 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ date: Date[1:486], format: &quot;1980-01-01&quot; &quot;1980-02-01&quot; &quot;1980-03-01&quot; ...
##   ..$ ipca: num [1:486] 6.62 4.62 6.04 5.29 5.7 5.31 5.55 4.95 4.23 9.48 ...
##  $ selic: tibble [411 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ date : Date[1:411], format: &quot;1986-06-01&quot; &quot;1986-07-01&quot; &quot;1986-08-01&quot; ...
##   ..$ selic: num [1:411] 1.27 1.95 2.57 2.94 1.96 ...</code></pre>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="ggplot2.html#cb518-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Voce pode acessar cada dataframe usando a sintaxe NOME_DA_LISTA$NOME_DO_OBJETO:</span></span>
<span id="cb518-2"><a href="ggplot2.html#cb518-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(lista_datasets<span class="sc">$</span>selic)</span></code></pre></div>
<pre><code>## tibble [411 × 2] (S3: tbl_df/tbl/data.frame)
##  $ date : Date[1:411], format: &quot;1986-06-01&quot; &quot;1986-07-01&quot; &quot;1986-08-01&quot; &quot;1986-09-01&quot; ...
##  $ selic: num [1:411] 1.27 1.95 2.57 2.94 1.96 ...</code></pre>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="ggplot2.html#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos então criar apenas um dataset que corresponde a junção dos dois dataframes</span></span>
<span id="cb520-2"><a href="ggplot2.html#cb520-2" aria-hidden="true" tabindex="-1"></a>df_st <span class="ot">&lt;-</span> <span class="fu">left_join</span>(lista_datasets<span class="sc">$</span>ipca,</span>
<span id="cb520-3"><a href="ggplot2.html#cb520-3" aria-hidden="true" tabindex="-1"></a>                   lista_datasets<span class="sc">$</span>selic,</span>
<span id="cb520-4"><a href="ggplot2.html#cb520-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="st">&quot;date&quot;</span>)</span>
<span id="cb520-5"><a href="ggplot2.html#cb520-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-6"><a href="ggplot2.html#cb520-6" aria-hidden="true" tabindex="-1"></a><span class="co"># conferindo o novo dataframe criado</span></span>
<span id="cb520-7"><a href="ggplot2.html#cb520-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_st)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   date        ipca selic
##   &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;
## 1 1980-01-01  6.62    NA
## 2 1980-02-01  4.62    NA
## 3 1980-03-01  6.04    NA
## 4 1980-04-01  5.29    NA
## 5 1980-05-01  5.7     NA
## 6 1980-06-01  5.31    NA</code></pre>
<p>Temos uma coluna de data (<code>date</code>), cuja classe é <code>Date</code> e será usada como eixo x no gráfico de séries temporais:</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="ggplot2.html#cb522-1" aria-hidden="true" tabindex="-1"></a><span class="co"># grafico do ipca</span></span>
<span id="cb522-2"><a href="ggplot2.html#cb522-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_st, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> ipca)) <span class="sc">+</span></span>
<span id="cb522-3"><a href="ggplot2.html#cb522-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-25-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Adicionar <code>geom_smooth(method = "loess")</code> ajuda a distinguir movimentos de tendência na série temporal:</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="ggplot2.html#cb523-1" aria-hidden="true" tabindex="-1"></a>df_st <span class="sc">%&gt;%</span> </span>
<span id="cb523-2"><a href="ggplot2.html#cb523-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">&quot;2008-01-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb523-3"><a href="ggplot2.html#cb523-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> selic)) <span class="sc">+</span></span>
<span id="cb523-4"><a href="ggplot2.html#cb523-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb523-5"><a href="ggplot2.html#cb523-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-26-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>É possível incluir no gráfico mais de uma variável no eixo y. Uma das alternativas é simplesmente acrescentar mais uma camada <code>geom_line()</code> com a nova variável:</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="ggplot2.html#cb525-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_st, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> ipca)) <span class="sc">+</span></span>
<span id="cb525-2"><a href="ggplot2.html#cb525-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb525-3"><a href="ggplot2.html#cb525-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adicionar mais uma camada de geom_line</span></span>
<span id="cb525-4"><a href="ggplot2.html#cb525-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> selic), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 77 row(s) containing missing values (geom_path).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-27-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>No entanto, a melhor maneira de se fazer isso é converter os dados para o formato long (tidy):</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="ggplot2.html#cb527-1" aria-hidden="true" tabindex="-1"></a>df_st_tidy <span class="ot">&lt;-</span> df_st <span class="sc">%&gt;%</span> </span>
<span id="cb527-2"><a href="ggplot2.html#cb527-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(indicador, valor, ipca<span class="sc">:</span>selic) <span class="sc">%&gt;%</span> </span>
<span id="cb527-3"><a href="ggplot2.html#cb527-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date)</span>
<span id="cb527-4"><a href="ggplot2.html#cb527-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb527-5"><a href="ggplot2.html#cb527-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_st_tidy)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   date       indicador valor
##   &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt;
## 1 1980-01-01 ipca       6.62
## 2 1980-01-01 selic     NA   
## 3 1980-02-01 ipca       4.62
## 4 1980-02-01 selic     NA   
## 5 1980-03-01 ipca       6.04
## 6 1980-03-01 selic     NA</code></pre>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="ggplot2.html#cb529-1" aria-hidden="true" tabindex="-1"></a><span class="co"># antes de proceder com o restante do exercicio, vamos salvar o dataset para</span></span>
<span id="cb529-2"><a href="ggplot2.html#cb529-2" aria-hidden="true" tabindex="-1"></a><span class="co"># o usar nos proximos modulos</span></span>
<span id="cb529-3"><a href="ggplot2.html#cb529-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(df_st_tidy, <span class="st">&quot;series_ipca_selic.rds&quot;</span>)</span></code></pre></div>
<p>Note que <code>indicador</code> é uma coluna categórica e <code>valor</code>, numérica. Portanto, a primeira será mapeada à <em>aesthetic</em> <strong>y</strong> e a segunda a <strong>color</strong>.
Agora, a variável <code>indicador</code> é mapeada ao atributo color.</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="ggplot2.html#cb530-1" aria-hidden="true" tabindex="-1"></a>df_st_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb530-2"><a href="ggplot2.html#cb530-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> valor, <span class="at">color =</span> indicador)) <span class="sc">+</span></span>
<span id="cb530-3"><a href="ggplot2.html#cb530-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 77 row(s) containing missing values (geom_path).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-29-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Notou como o período antes de 1995 representava uma realidade muito diferente da atual? Vamos então filtrar os dados a partir desse ano.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="ggplot2.html#cb532-1" aria-hidden="true" tabindex="-1"></a>df_st_pos_1995 <span class="ot">&lt;-</span> df_st_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb532-2"><a href="ggplot2.html#cb532-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">&quot;1995-01-01&quot;</span>))</span>
<span id="cb532-3"><a href="ggplot2.html#cb532-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-4"><a href="ggplot2.html#cb532-4" aria-hidden="true" tabindex="-1"></a>df_st_pos_1995 <span class="sc">%&gt;%</span> </span>
<span id="cb532-5"><a href="ggplot2.html#cb532-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> valor, <span class="at">color =</span> indicador)) <span class="sc">+</span></span>
<span id="cb532-6"><a href="ggplot2.html#cb532-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-30-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="histogramas" class="section level3" number="12.3.6">
<h3><span class="header-section-number">12.3.6</span> Histogramas</h3>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="ggplot2.html#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_histogram</span>(<span class="at">mapping =</span> <span class="cn">NULL</span>, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">stat =</span> <span class="st">&quot;bin&quot;</span>,</span>
<span id="cb533-2"><a href="ggplot2.html#cb533-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, ..., <span class="at">binwidth =</span> <span class="cn">NULL</span>, <span class="at">bins =</span> <span class="cn">NULL</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb533-3"><a href="ggplot2.html#cb533-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">show.legend =</span> <span class="cn">NA</span>, <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Os histogramas são utilizados para representar-se a distribuição de dados de uma variável quantitativa em intervalos contínuos. Esses intervalos são chamados de <code>bins</code>. Para cada bin, será apresentada a quantidade de valores que estão naquele intervalo.</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="ggplot2.html#cb534-1" aria-hidden="true" tabindex="-1"></a>df_2017 <span class="sc">%&gt;%</span> </span>
<span id="cb534-2"><a href="ggplot2.html#cb534-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb534-3"><a href="ggplot2.html#cb534-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-32-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>A função <code>geom_histogram()</code>, por padrão, “quebra” a variável em 30 intervalos. É possível mudar esse comportamento especificando o argumento <code>bins</code>:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="ggplot2.html#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reduzindo o numero de intervalos</span></span>
<span id="cb536-2"><a href="ggplot2.html#cb536-2" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb536-3"><a href="ggplot2.html#cb536-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb536-4"><a href="ggplot2.html#cb536-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-33-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="ggplot2.html#cb537-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aumentando o número de intervalos</span></span>
<span id="cb537-2"><a href="ggplot2.html#cb537-2" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb537-3"><a href="ggplot2.html#cb537-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb537-4"><a href="ggplot2.html#cb537-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">40</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-34-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Outra maneira de redefinir os intervalos de um histograma é mudando o argumento <code>binwidth</code>, que controla a largura dos intervalos. Não é possível definir os argumentos <code>bins</code> e <code>binwidth</code> de uma só vez; ou um ou o outro.</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="ggplot2.html#cb538-1" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb538-2"><a href="ggplot2.html#cb538-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb538-3"><a href="ggplot2.html#cb538-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-35-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>No histograma acima, ao definir a largura dos intervalos como 5, o histograma criou intervalos usando como centros os números 45, 50, 55, etc. Portanto, os intervalos são [42,5 - 47,5), [47,5 - 52,5), etc.</p>
<p>É possível també definir os limites dos intervalos. Por exemplo, caso você deseje que os intervalos comecem com números que terminem em 5, deve-se alterar o argumento <code>boundary</code>:</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="ggplot2.html#cb539-1" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb539-2"><a href="ggplot2.html#cb539-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb539-3"><a href="ggplot2.html#cb539-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>, <span class="at">boundary =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-36-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Assim, conseguimos criar uma visualização que mostra que a grande maioria dos países possui uma expectativa de vida maior que 60 anos, e que alguns poucos países possuem uma expectativa de vida menor que 50 anos e maior que 75.</p>
<p>Como você já deve ter imaginado, é possível mudar aspectos visuais do histograma alterando suas <em>aesthetics</em>, como mudar a cor do histograma por valores atributos ou mapear alguma variável à cor do histograma. Veja que a cor de um histograma é definida pela propriedade <code>fill</code>, pois <code>color</code> altera apenas a cor das bordas das barras:</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="ggplot2.html#cb540-1" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb540-2"><a href="ggplot2.html#cb540-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb540-3"><a href="ggplot2.html#cb540-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>, <span class="at">boundary =</span> <span class="dv">5</span>,</span>
<span id="cb540-4"><a href="ggplot2.html#cb540-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;green&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-37-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="ggplot2.html#cb541-1" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb541-2"><a href="ggplot2.html#cb541-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb541-3"><a href="ggplot2.html#cb541-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>, <span class="at">boundary =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">fill =</span> continent))</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-38-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="boxplots-e-violinplots" class="section level3" number="12.3.7">
<h3><span class="header-section-number">12.3.7</span> Boxplots e violinplots</h3>
<p>O boxplot é uma representação comum para apresentar-se a distribuição de uma variável a partir de seus quantis. A imagem abaixo detalha como um boxplot é formado.</p>
<div class="figure">
<img src="images/boxplot.png" alt="" />
<p class="caption">Detalhes sobre o bloxplot</p>
</div>
<p>O boxplot também pode ser usado para verificar-se a distribuição de variável para um conjunto de valores de uma segunda variável. Por exemplo: qual é a distribuição da expectativa de vida por ano?</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="ggplot2.html#cb542-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_2017, <span class="fu">aes</span>(<span class="at">x =</span> continent,</span>
<span id="cb542-2"><a href="ggplot2.html#cb542-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb542-3"><a href="ggplot2.html#cb542-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-39-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Vemos que existe um possível outlier em 1992. Quando falarmos sobre anotações, voltaremos a este gráfico.</p>
<p>Para termos uma visão da distribuição geral dos valores por ano, podemos utilizar o <code>geom_violin()</code>. O violinplot baseia-se na densidade de probabilidade de uma variável contínua. Assim, é possível verificar-se em quais intervalos existe uma maior chance de ocorrência. Isto é representado pela parte mais larga do objeto.</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="ggplot2.html#cb543-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_2017, <span class="fu">aes</span>(<span class="at">x =</span> continent,</span>
<span id="cb543-2"><a href="ggplot2.html#cb543-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb543-3"><a href="ggplot2.html#cb543-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>()</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-40-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="textosrótulos" class="section level3" number="12.3.8">
<h3><span class="header-section-number">12.3.8</span> Textos/Rótulos</h3>
<p>As funções <code>geom_text()</code> e <code>geom_label()</code> servem para acrescentar camadas de texto no gráfico. A única diferença entre as duas é que <code>geom_label()</code> desenha um retângulo no fundo do texto, possivelmente melhorando sua leitura. Ambas funções <code>geom_text()</code> dependem de três <em>aesthetics</em>: <strong>x</strong> e <strong>y</strong>, que correspondem às posições dos textos a serem plotados, e <strong>label</strong>, que é o texto a ser plotado.</p>
<p>No exemplo abaixo, não especificamos <strong>x</strong> e <strong>y</strong> em <code>geom_text()</code> porque a função herda as definidas na função <code>ggplot()</code>:</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="ggplot2.html#cb544-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_label</span>(<span class="at">mapping =</span> <span class="cn">NULL</span>, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb544-2"><a href="ggplot2.html#cb544-2" aria-hidden="true" tabindex="-1"></a>           ..., <span class="at">parse =</span> <span class="cn">FALSE</span>, <span class="at">nudge_x =</span> <span class="dv">0</span>, <span class="at">nudge_y =</span> <span class="dv">0</span>,</span>
<span id="cb544-3"><a href="ggplot2.html#cb544-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">label.padding =</span> <span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">&quot;lines&quot;</span>), <span class="at">label.r =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb544-4"><a href="ggplot2.html#cb544-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">label.size =</span> <span class="fl">0.25</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">NA</span>, <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>)</span>
<span id="cb544-5"><a href="ggplot2.html#cb544-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb544-6"><a href="ggplot2.html#cb544-6" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_text</span>(<span class="at">mapping =</span> <span class="cn">NULL</span>, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb544-7"><a href="ggplot2.html#cb544-7" aria-hidden="true" tabindex="-1"></a>          ..., <span class="at">parse =</span> <span class="cn">FALSE</span>, <span class="at">nudge_x =</span> <span class="dv">0</span>, <span class="at">nudge_y =</span> <span class="dv">0</span>, <span class="at">check_overlap =</span> <span class="cn">FALSE</span>,</span>
<span id="cb544-8"><a href="ggplot2.html#cb544-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">NA</span>, <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Os parâmetros estéticos (<code>aes</code>) são:</p>
<ul>
<li><strong><code>label</code></strong></li>
<li><strong><code>x</code></strong></li>
<li><strong><code>y</code></strong></li>
<li><code>alpha</code></li>
<li><code>angle</code></li>
<li><code>colour</code></li>
<li><code>family</code></li>
<li><code>fontface</code></li>
<li><code>hjust</code></li>
<li><code>lineheight</code></li>
<li><code>size</code></li>
<li><code>vjust</code></li>
</ul>
<p>Para adicionar textos ou rótulos, utilizamos, respectivamente, o <code>geom_text()</code> e o <code>geom_label()</code>, que se diferenciam na formatação. Isto ficará mais claro nos exemplos a seguir:</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="ggplot2.html#cb545-1" aria-hidden="true" tabindex="-1"></a>df_2017 <span class="sc">%&gt;%</span> </span>
<span id="cb545-2"><a href="ggplot2.html#cb545-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb545-3"><a href="ggplot2.html#cb545-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">life_expec_media =</span> <span class="fu">round</span>(<span class="fu">mean</span>(life_expec))) <span class="sc">%&gt;%</span> </span>
<span id="cb545-4"><a href="ggplot2.html#cb545-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> continent, <span class="at">y =</span> life_expec_media)) <span class="sc">+</span></span>
<span id="cb545-5"><a href="ggplot2.html#cb545-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb545-6"><a href="ggplot2.html#cb545-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> life_expec_media), </span>
<span id="cb545-7"><a href="ggplot2.html#cb545-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-42-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="ggplot2.html#cb546-1" aria-hidden="true" tabindex="-1"></a>df_2017 <span class="sc">%&gt;%</span> </span>
<span id="cb546-2"><a href="ggplot2.html#cb546-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span> </span>
<span id="cb546-3"><a href="ggplot2.html#cb546-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">life_expec_media =</span> <span class="fu">round</span>(<span class="fu">mean</span>(life_expec))) <span class="sc">%&gt;%</span> </span>
<span id="cb546-4"><a href="ggplot2.html#cb546-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> continent, <span class="at">y =</span> life_expec_media)) <span class="sc">+</span></span>
<span id="cb546-5"><a href="ggplot2.html#cb546-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb546-6"><a href="ggplot2.html#cb546-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> life_expec_media), </span>
<span id="cb546-7"><a href="ggplot2.html#cb546-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-43-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Suponha que no primeiro gráfico de pontos mostrado no material, que mostra a relação entre PIB per capita e expectativa de vida, você deseja também acrescentar os nomes dos países:</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="ggplot2.html#cb547-1" aria-hidden="true" tabindex="-1"></a>df_2017 <span class="sc">%&gt;%</span> </span>
<span id="cb547-2"><a href="ggplot2.html#cb547-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita,</span>
<span id="cb547-3"><a href="ggplot2.html#cb547-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb547-4"><a href="ggplot2.html#cb547-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb547-5"><a href="ggplot2.html#cb547-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> country))</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_text).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-44-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Como era de se esperar, o gráfico ficou muito poluído. Vamos então reduzir os pontos que queremos mostrar os nomes dos respectivos países apenas aos países dos continentes americanos. A estrategia, então, consiste em criar um novo dataframe com esses países e mudar o argumento <code>data</code> em geom_text:</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="ggplot2.html#cb550-1" aria-hidden="true" tabindex="-1"></a>america <span class="ot">&lt;-</span> df_2017 <span class="sc">%&gt;%</span> </span>
<span id="cb550-2"><a href="ggplot2.html#cb550-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">&quot;Americas&quot;</span>)</span>
<span id="cb550-3"><a href="ggplot2.html#cb550-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb550-4"><a href="ggplot2.html#cb550-4" aria-hidden="true" tabindex="-1"></a>df_2017 <span class="sc">%&gt;%</span> </span>
<span id="cb550-5"><a href="ggplot2.html#cb550-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita,</span>
<span id="cb550-6"><a href="ggplot2.html#cb550-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb550-7"><a href="ggplot2.html#cb550-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb550-8"><a href="ggplot2.html#cb550-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> america, <span class="fu">aes</span>(<span class="at">label =</span> country))</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-45-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Melhorou, mas ainda assim ficou poluído. Uma boa solução para esse problema é o pacote <code>ggrepel</code>, que internamente calcula a melhor posição entre os pontos da camada de texto, seja <code>geom_text()</code> ou <code>geom_label()</code>, de forma que não haja conflito de posição entre pontos. A única alteração necessária é mudar <code>geom_text</code> para <code>geom_text_repel</code>:</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="ggplot2.html#cb552-1" aria-hidden="true" tabindex="-1"></a>df_2017 <span class="sc">%&gt;%</span> </span>
<span id="cb552-2"><a href="ggplot2.html#cb552-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita,</span>
<span id="cb552-3"><a href="ggplot2.html#cb552-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb552-4"><a href="ggplot2.html#cb552-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb552-5"><a href="ggplot2.html#cb552-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> america, <span class="fu">aes</span>(<span class="at">label =</span> country))</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-46-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="anotações" class="section level3" number="12.3.9">
<h3><span class="header-section-number">12.3.9</span> Anotações</h3>
<p>Para criarmos anotações no ggplot2, podemos utilizar a função <code>annotate()</code>.</p>
<p>Primeiro, vamos manipular os dados para saber qual é aquele ponto:</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="ggplot2.html#cb554-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_2017, <span class="fu">aes</span>(<span class="at">x =</span> continent,</span>
<span id="cb554-2"><a href="ggplot2.html#cb554-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb554-3"><a href="ggplot2.html#cb554-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-47-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="ggplot2.html#cb555-1" aria-hidden="true" tabindex="-1"></a>df_2017 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">&quot;Americas&quot;</span>, life_expec <span class="sc">&lt;</span> <span class="dv">60</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 22
##   country  year life_ladder log_gdp_per_capita social_support life_expec freedom_to_make_life_choices generosity perceptions_of_c…
##   &lt;chr&gt;   &lt;dbl&gt;       &lt;dbl&gt;              &lt;dbl&gt;          &lt;dbl&gt;      &lt;dbl&gt;                        &lt;dbl&gt;      &lt;dbl&gt;             &lt;dbl&gt;
## 1 Haiti    2017        3.82               7.40          0.647       53.3                        0.484      0.385             0.647
## # … with 13 more variables: positive_affect &lt;dbl&gt;, negative_affect &lt;dbl&gt;, confidence_in_national_government &lt;dbl&gt;,
## #   democratic_quality &lt;dbl&gt;, delivery_quality &lt;dbl&gt;, standard_deviation_of_ladder_by_country_year &lt;dbl&gt;,
## #   standard_deviation_mean_of_ladder_by_country_year &lt;dbl&gt;, gini_index_world_bank_estimate &lt;dbl&gt;,
## #   gini_index_world_bank_estimate_average_2000_15 &lt;dbl&gt;, gini_of_household_income_reported_in_gallup_by_wp5_year &lt;dbl&gt;,
## #   continent &lt;chr&gt;, country_code &lt;dbl&gt;, populacao_2020 &lt;dbl&gt;</code></pre>
<p>Com essas informações, podemos adicionar uma anotação ao gráfico:</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="ggplot2.html#cb557-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_2017, <span class="fu">aes</span>(<span class="at">x =</span> continent,</span>
<span id="cb557-2"><a href="ggplot2.html#cb557-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb557-3"><a href="ggplot2.html#cb557-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb557-4"><a href="ggplot2.html#cb557-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Americas&quot;</span>, <span class="at">y =</span> <span class="dv">52</span>, <span class="at">label =</span> <span class="st">&quot;Haiti&quot;</span>) </span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-49-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Também podemos adicionar segmentos e retângulos com o <code>annotate()</code>. Vamos marcar o período de 1982 a 2002 com um retângulo:</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="ggplot2.html#cb558-1" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb558-2"><a href="ggplot2.html#cb558-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">&quot;Brazil&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb558-3"><a href="ggplot2.html#cb558-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> log_gdp_per_capita)) <span class="sc">+</span></span>
<span id="cb558-4"><a href="ggplot2.html#cb558-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb558-5"><a href="ggplot2.html#cb558-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb558-6"><a href="ggplot2.html#cb558-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>,</span>
<span id="cb558-7"><a href="ggplot2.html#cb558-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="dv">2010</span>, <span class="at">xmax =</span> <span class="dv">2014</span>,</span>
<span id="cb558-8"><a href="ggplot2.html#cb558-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>, </span>
<span id="cb558-9"><a href="ggplot2.html#cb558-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-50-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="cleveland-dot-plot" class="section level3" number="12.3.10">
<h3><span class="header-section-number">12.3.10</span> Cleveland Dot Plot</h3>
<p>O cleveland dot plot é uma visualização que pode substituir os gráficos de barras. A ideia é que o gráfico fica menos poluído com os pontos, fazendo com que o leitor foque no que é importante. Vamos criar um gráfico para comparar as expectativas de vida no ano de 2007 para os países das Américas:</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="ggplot2.html#cb559-1" aria-hidden="true" tabindex="-1"></a>df_2017 <span class="sc">%&gt;%</span> </span>
<span id="cb559-2"><a href="ggplot2.html#cb559-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">&quot;Americas&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb559-3"><a href="ggplot2.html#cb559-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> life_expec, <span class="at">y =</span> <span class="fu">reorder</span>(country, life_expec))) <span class="sc">+</span></span>
<span id="cb559-4"><a href="ggplot2.html#cb559-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue&quot;</span>) </span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-51-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Esse tipo de gráfico também pode apresentar mais de um ponto para cada valor da variável categórica (país):</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="ggplot2.html#cb560-1" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb560-2"><a href="ggplot2.html#cb560-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2010</span>, <span class="dv">2017</span>),</span>
<span id="cb560-3"><a href="ggplot2.html#cb560-3" aria-hidden="true" tabindex="-1"></a>         continent <span class="sc">==</span> <span class="st">&quot;Americas&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb560-4"><a href="ggplot2.html#cb560-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita, <span class="at">y =</span> country, <span class="at">color =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb560-5"><a href="ggplot2.html#cb560-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(year)))</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-52-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>No gráfico acima, vemos dois pontos para cada país, um para representar 1987 e outro para 2007.</p>
<p>Para completarmos o gráfico, precisamos adicionar uma linha conectando esses dois pontos. Esse gráfico é chamado de <em>connected dot plot</em>. Um detalhe importante é que queremos criar uma linha por país, assim, usaremos o elemento estético <code>group</code> para obter o resultado esperado:</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="ggplot2.html#cb561-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb561-2"><a href="ggplot2.html#cb561-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1987</span>, <span class="dv">2007</span>),</span>
<span id="cb561-3"><a href="ggplot2.html#cb561-3" aria-hidden="true" tabindex="-1"></a>         continent <span class="sc">==</span> <span class="st">&quot;Americas&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb561-4"><a href="ggplot2.html#cb561-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> country)) <span class="sc">+</span></span>
<span id="cb561-5"><a href="ggplot2.html#cb561-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> country)) <span class="sc">+</span></span>
<span id="cb561-6"><a href="ggplot2.html#cb561-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span> </span>
<span id="cb561-7"><a href="ggplot2.html#cb561-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Expectativa de vida por país - 1987 e 2007&quot;</span>,</span>
<span id="cb561-8"><a href="ggplot2.html#cb561-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;País&quot;</span>,</span>
<span id="cb561-9"><a href="ggplot2.html#cb561-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Anos&quot;</span>,</span>
<span id="cb561-10"><a href="ggplot2.html#cb561-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Ano&quot;</span>) <span class="sc">+</span></span>
<span id="cb561-11"><a href="ggplot2.html#cb561-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>))</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-53-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Para finalizar, vamos ordenar o eixo <code>y</code> pela expectativa de vida:</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="ggplot2.html#cb562-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb562-2"><a href="ggplot2.html#cb562-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1987</span>, <span class="dv">2007</span>),</span>
<span id="cb562-3"><a href="ggplot2.html#cb562-3" aria-hidden="true" tabindex="-1"></a>         continent <span class="sc">==</span> <span class="st">&quot;Americas&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb562-4"><a href="ggplot2.html#cb562-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lifeExp, <span class="at">y =</span> <span class="fu">reorder</span>(country, lifeExp, max))) <span class="sc">+</span></span>
<span id="cb562-5"><a href="ggplot2.html#cb562-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> country), <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="sc">+</span></span>
<span id="cb562-6"><a href="ggplot2.html#cb562-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span> </span>
<span id="cb562-7"><a href="ggplot2.html#cb562-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Expectativa de vida por país - 1987 e 2007&quot;</span>,</span>
<span id="cb562-8"><a href="ggplot2.html#cb562-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;País&quot;</span>,</span>
<span id="cb562-9"><a href="ggplot2.html#cb562-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Anos&quot;</span>,</span>
<span id="cb562-10"><a href="ggplot2.html#cb562-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Ano&quot;</span>) <span class="sc">+</span></span>
<span id="cb562-11"><a href="ggplot2.html#cb562-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>))</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-54-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="mapas-de-calor" class="section level3" number="12.3.11">
<h3><span class="header-section-number">12.3.11</span> Mapas de calor</h3>
<p>Para representar uma relação um pouco mais complexa, a de duas variáveis categóricas e uma numérica, pode-se usar um mapa de calor.</p>
<p>Suponha que você deseja plotar a correlação entre todos os possíveis pares de correlação das variáveis de um dataset:</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="ggplot2.html#cb563-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calcular correlacao entre as variaveis numericas do dataset de felicidade</span></span>
<span id="cb563-2"><a href="ggplot2.html#cb563-2" aria-hidden="true" tabindex="-1"></a>df_feliz_num <span class="ot">&lt;-</span> df_2017 <span class="sc">%&gt;%</span></span>
<span id="cb563-3"><a href="ggplot2.html#cb563-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(life_ladder, log_gdp_per_capita, social_support,</span>
<span id="cb563-4"><a href="ggplot2.html#cb563-4" aria-hidden="true" tabindex="-1"></a>         life_expec, perceptions_of_corruption) <span class="sc">%&gt;%</span></span>
<span id="cb563-5"><a href="ggplot2.html#cb563-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># removar NAs</span></span>
<span id="cb563-6"><a href="ggplot2.html#cb563-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb563-7"><a href="ggplot2.html#cb563-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb563-8"><a href="ggplot2.html#cb563-8" aria-hidden="true" tabindex="-1"></a><span class="co"># criar matriz de correlacao</span></span>
<span id="cb563-9"><a href="ggplot2.html#cb563-9" aria-hidden="true" tabindex="-1"></a>matriz_correl <span class="ot">&lt;-</span> <span class="fu">cor</span>(df_feliz_num)</span>
<span id="cb563-10"><a href="ggplot2.html#cb563-10" aria-hidden="true" tabindex="-1"></a><span class="co"># de uma olhada no objeto criado</span></span>
<span id="cb563-11"><a href="ggplot2.html#cb563-11" aria-hidden="true" tabindex="-1"></a><span class="co"># matriz_correl</span></span>
<span id="cb563-12"><a href="ggplot2.html#cb563-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb563-13"><a href="ggplot2.html#cb563-13" aria-hidden="true" tabindex="-1"></a><span class="co"># transformar para dataframe</span></span>
<span id="cb563-14"><a href="ggplot2.html#cb563-14" aria-hidden="true" tabindex="-1"></a>matriz_correl <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(matriz_correl) </span>
<span id="cb563-15"><a href="ggplot2.html#cb563-15" aria-hidden="true" tabindex="-1"></a><span class="co"># conveter rownames para uma coluna</span></span>
<span id="cb563-16"><a href="ggplot2.html#cb563-16" aria-hidden="true" tabindex="-1"></a>matriz_correl <span class="ot">&lt;-</span> <span class="fu">rownames_to_column</span>(matriz_correl, <span class="st">&quot;var1&quot;</span>)</span>
<span id="cb563-17"><a href="ggplot2.html#cb563-17" aria-hidden="true" tabindex="-1"></a><span class="co"># converter dataframe para formato tidy</span></span>
<span id="cb563-18"><a href="ggplot2.html#cb563-18" aria-hidden="true" tabindex="-1"></a>matriz_correl_tidy <span class="ot">&lt;-</span> matriz_correl <span class="sc">%&gt;%</span> </span>
<span id="cb563-19"><a href="ggplot2.html#cb563-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(var2, correlacao, <span class="sc">-</span>var1)</span>
<span id="cb563-20"><a href="ggplot2.html#cb563-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb563-21"><a href="ggplot2.html#cb563-21" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(matriz_correl_tidy)</span></code></pre></div>
<pre><code>##                        var1               var2 correlacao
## 1               life_ladder        life_ladder  1.0000000
## 2        log_gdp_per_capita        life_ladder  0.7531552
## 3            social_support        life_ladder  0.7665324
## 4                life_expec        life_ladder  0.7359065
## 5 perceptions_of_corruption        life_ladder -0.5163756
## 6               life_ladder log_gdp_per_capita  0.7531552</code></pre>
<p>Assim, no dataframe <code>var1</code> e <code>var2</code>, temos duas variáveis categóricas (os pares de variáveis) e uma numérica (a correlação entre as duas variáveis).</p>
<p>A função do <code>ggplot2</code> para criar um mapa de calor é <code>geom_tile</code>, que precisa de três <em>aesthetics</em>: os eixos <strong>x</strong> e <strong>y</strong>, que são as variáveis categóricas, e <strong>fill</strong>, que será a variável contínua que definirá a cor dos quadrados:</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="ggplot2.html#cb565-1" aria-hidden="true" tabindex="-1"></a>matriz_correl_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb565-2"><a href="ggplot2.html#cb565-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> var1, <span class="at">y =</span> var2, <span class="at">fill =</span> correlacao)) <span class="sc">+</span></span>
<span id="cb565-3"><a href="ggplot2.html#cb565-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>()</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-56-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Devido ao tamanho dos nomes das variáveis, o eixo x ficou difícil de ler. Uma solução é mudar o ângulo dos nomes, isto é, colocá-los na vertical. A função <code>theme()</code>, que ainda será mostrada em detalhes neste módulo, possui um argumento para fazer isso:</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="ggplot2.html#cb566-1" aria-hidden="true" tabindex="-1"></a>matriz_correl_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb566-2"><a href="ggplot2.html#cb566-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> var1, <span class="at">y =</span> var2, <span class="at">fill =</span> correlacao)) <span class="sc">+</span></span>
<span id="cb566-3"><a href="ggplot2.html#cb566-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb566-4"><a href="ggplot2.html#cb566-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-57-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="escalas" class="section level2" number="12.4">
<h2><span class="header-section-number">12.4</span> Escalas</h2>
<p>O controle sobre as escalas do gráfico é fundamental no ajuste de um gráfico. Em geral, o ggplot2, como outros pacotes gráficos, fornece as escalas automaticamente, não sendo necessário o entendimento de como se controlar este componente. No entanto, se o interesse é ter controle sobre todos os aspectos de um gráfico, esse componente é fundamental.</p>
<p>Veja o gráfico abaixo:</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="ggplot2.html#cb567-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Petal.Length, <span class="at">y =</span> Petal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb567-2"><a href="ggplot2.html#cb567-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-58-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Note que a cor está mapeada para a variável <code>Species</code>. O <code>ggplot2</code>, automaticamente, criou a seguinte escala:</p>
<table>
<thead>
<tr class="header">
<th align="center">Species</th>
<th align="center">Cor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">setosa</td>
<td align="center">vermelho</td>
</tr>
<tr class="even">
<td align="center">versicolor</td>
<td align="center">verde</td>
</tr>
<tr class="odd">
<td align="center">virginica</td>
<td align="center">azul</td>
</tr>
</tbody>
</table>
<p>Todavia, é comum haver interesse em alterar-se essas cores, ou seja, alterar-se a escala de cor. Como fazer isso no ggplot2? Podemos usar, por exemplo, a função <code>scale_color_manual()</code>:</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="ggplot2.html#cb568-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Petal.Length, <span class="at">y =</span> Petal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb568-2"><a href="ggplot2.html#cb568-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb568-3"><a href="ggplot2.html#cb568-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-59-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Utilizamos a função <code>scale_color_manual()</code> em razão da variável <code>Species</code> ser categórica. Para o ggplot2, dados categóricos são discretos, e a função citada permite criar-se uma escala discreta customizada. No entanto, essa não é a única função para controlar escala de cor. Existem outras como <code>scale_color_discrete()</code>, <code>scale_color_continuous()</code>, <code>scale_color_gradient()</code> etc. A utilização de cada função depende do tipo de dado que se está associando ao elemento estético <code>color</code>. Adiante, entraremos em mais detalhes sobre os tipos de dados.</p>
<p>As funções utilizadas para controlar-se as escalas dos elementos de um gráfico do ggplot2 seguem um padrão. Todas iniciam-se com <code>scale_</code>, depois o nome do elemento estético (color, fill, x etc.) e, por fim, o tipo/nome da escala que será aplicada.</p>
<p>Abaixo, continuaremos o exemplo anterior, alterando as escalas dos eixos x e y. Note que as variáveis <code>Petal.Length</code> e <code>Petal.Width</code> são variáveis numéricas/contínuas. Dessa forma, utilizaremos as funções <code>scale_x_continuous()</code> e <code>scale_y_continuous()</code>:</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="ggplot2.html#cb569-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Petal.Length, <span class="at">y =</span> Petal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb569-2"><a href="ggplot2.html#cb569-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb569-3"><a href="ggplot2.html#cb569-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb569-4"><a href="ggplot2.html#cb569-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">&quot;Petal Length&quot;</span>, <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb569-5"><a href="ggplot2.html#cb569-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">&quot;Petal Width&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>))</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-60-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>No gráfico acima, definimos quais seriam os pontos em que rótulos deveriam ser exibidos em cada eixo. Além disso, no eixo y, definimos que os limites seriam 0 e 3.</p>
<div id="tipos-de-variáveis" class="section level3" number="12.4.1">
<h3><span class="header-section-number">12.4.1</span> Tipos de Variáveis</h3>
<p>Para melhor uso das escalas, é preciso saber o tipo de variável que foi mapeado para cada elemento estético. Vamos rapidamente montar essa relação:</p>
<table>
<thead>
<tr class="header">
<th align="center">Classe</th>
<th align="center">Exemplo</th>
<th align="center">Tipo no ggplot2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">numeric</td>
<td align="center">seq(0, 1, length.out = 10)</td>
<td align="center">continuous</td>
</tr>
<tr class="even">
<td align="center">integer</td>
<td align="center">1L:10L</td>
<td align="center">continuous ou discrete</td>
</tr>
<tr class="odd">
<td align="center">character</td>
<td align="center">c(“Sim,” “Não”)</td>
<td align="center">discrete</td>
</tr>
<tr class="even">
<td align="center">factor</td>
<td align="center">factor(c(“Sim,” “Não”))</td>
<td align="center">discrete</td>
</tr>
<tr class="odd">
<td align="center">date</td>
<td align="center">seq(as.Date(“2000/1/1”), by = “month,” length.out = 12)</td>
<td align="center">date</td>
</tr>
</tbody>
</table>
<p>Lembre-se que o padrão do ggplot é <code>scale_</code>, depois o nome do elemento estético (color, fill, x etc.) e, por fim, o tipo/nome da escala que será aplicada. É importante que o usuário saiba o tipo de dado, pois assim saberá com mais facilidade qual é o tipo de escala que deve ser escolhido.</p>
<p>Vamos, em sequência, entrar em mais detalhes para escalas dos eixos (<code>x</code> e <code>y</code>) e de cores. Espera-se que a intuição desenvolvida a partir dos exemplos das escalas para esses elementos estéticos seja útil para os demais elementos estéticos.</p>
</div>
<div id="eixos" class="section level3" number="12.4.2">
<h3><span class="header-section-number">12.4.2</span> Eixos</h3>
<div id="variáveis-contínuas" class="section level4" number="12.4.2.1">
<h4><span class="header-section-number">12.4.2.1</span> Variáveis Contínuas</h4>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="ggplot2.html#cb570-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="fu">waiver</span>(), <span class="at">breaks =</span> <span class="fu">waiver</span>(), <span class="at">minor_breaks =</span> <span class="fu">waiver</span>(),</span>
<span id="cb570-2"><a href="ggplot2.html#cb570-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">waiver</span>(), <span class="at">limits =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">waiver</span>(),</span>
<span id="cb570-3"><a href="ggplot2.html#cb570-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">oob =</span> censor, <span class="at">na.value =</span> <span class="cn">NA_real_</span>, <span class="at">trans =</span> <span class="st">&quot;identity&quot;</span>)</span>
<span id="cb570-4"><a href="ggplot2.html#cb570-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb570-5"><a href="ggplot2.html#cb570-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="fu">waiver</span>(), <span class="at">breaks =</span> <span class="fu">waiver</span>(), <span class="at">minor_breaks =</span> <span class="fu">waiver</span>(),</span>
<span id="cb570-6"><a href="ggplot2.html#cb570-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">waiver</span>(), <span class="at">limits =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">waiver</span>(),</span>
<span id="cb570-7"><a href="ggplot2.html#cb570-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">oob =</span> censor, <span class="at">na.value =</span> <span class="cn">NA_real_</span>, <span class="at">trans =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p>Vamos começar editando os valores dos eixos <code>x</code> e <code>y</code>.</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="ggplot2.html#cb571-1" aria-hidden="true" tabindex="-1"></a>df_2017 <span class="sc">%&gt;%</span> </span>
<span id="cb571-2"><a href="ggplot2.html#cb571-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">populacao_milhoes =</span> populacao_2020 <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb571-3"><a href="ggplot2.html#cb571-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> populacao_milhoes,</span>
<span id="cb571-4"><a href="ggplot2.html#cb571-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb571-5"><a href="ggplot2.html#cb571-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb571-6"><a href="ggplot2.html#cb571-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># definindo manualmente a escala do eixo x</span></span>
<span id="cb571-7"><a href="ggplot2.html#cb571-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>, <span class="dv">500</span>, <span class="dv">1500</span>)) <span class="sc">+</span></span>
<span id="cb571-8"><a href="ggplot2.html#cb571-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># definindo os intervalos da escala do eixo y</span></span>
<span id="cb571-9"><a href="ggplot2.html#cb571-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_width</span>(<span class="dv">5</span>),</span>
<span id="cb571-10"><a href="ggplot2.html#cb571-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">minor_breaks =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-62-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="variáveis-discretas" class="section level4" number="12.4.2.2">
<h4><span class="header-section-number">12.4.2.2</span> Variáveis discretas</h4>
<p>Apesar do <em>help</em> não apresentar todos os argumentos para as escalas discretas, podemos usar quase todos que foram listados para escala contínua.</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="ggplot2.html#cb572-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_discrete</span>(..., <span class="at">expand =</span> <span class="fu">waiver</span>(), <span class="at">position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb572-2"><a href="ggplot2.html#cb572-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb572-3"><a href="ggplot2.html#cb572-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_y_discrete</span>(..., <span class="at">expand =</span> <span class="fu">waiver</span>(), <span class="at">position =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<p>No exemplo abaixo, alteraremos os rótulos para uma escala discreta, que originalmente contém os valores <code>Yes</code> e <code>No</code>.</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="ggplot2.html#cb573-1" aria-hidden="true" tabindex="-1"></a>df_2017 <span class="sc">%&gt;%</span> </span>
<span id="cb573-2"><a href="ggplot2.html#cb573-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(continent, <span class="at">name =</span> <span class="st">&quot;qtd_paises&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb573-3"><a href="ggplot2.html#cb573-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> continent, </span>
<span id="cb573-4"><a href="ggplot2.html#cb573-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> qtd_paises)) <span class="sc">+</span></span>
<span id="cb573-5"><a href="ggplot2.html#cb573-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb573-6"><a href="ggplot2.html#cb573-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;África&quot;</span>, <span class="st">&quot;AMÉRICAS&quot;</span>, <span class="st">&quot;Ásia&quot;</span>, <span class="st">&quot;Europa&quot;</span>, <span class="st">&quot;Oceania&quot;</span>))</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-64-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="variáveis-de-datas" class="section level4" number="12.4.2.3">
<h4><span class="header-section-number">12.4.2.3</span> Variáveis de Datas</h4>
<p>Quando estamos trabalhando com séries temporais, é comum que datas sejam associadas a algum eixo do gŕafico, geralmente ao eixo <code>x</code>. As funções padrão para controle de escalas dos eixos, para variáveis de datas, são as seguintes:</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="ggplot2.html#cb574-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_date</span>(<span class="at">name =</span> <span class="fu">waiver</span>(), <span class="at">breaks =</span> <span class="fu">waiver</span>(), <span class="at">date_breaks =</span> <span class="fu">waiver</span>(),</span>
<span id="cb574-2"><a href="ggplot2.html#cb574-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">labels =</span> <span class="fu">waiver</span>(), <span class="at">date_labels =</span> <span class="fu">waiver</span>(), <span class="at">minor_breaks =</span> <span class="fu">waiver</span>(),</span>
<span id="cb574-3"><a href="ggplot2.html#cb574-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">date_minor_breaks =</span> <span class="fu">waiver</span>(), <span class="at">limits =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">waiver</span>())</span>
<span id="cb574-4"><a href="ggplot2.html#cb574-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-5"><a href="ggplot2.html#cb574-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_y_date</span>(<span class="at">name =</span> <span class="fu">waiver</span>(), <span class="at">breaks =</span> <span class="fu">waiver</span>(), <span class="at">date_breaks =</span> <span class="fu">waiver</span>(),</span>
<span id="cb574-6"><a href="ggplot2.html#cb574-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">labels =</span> <span class="fu">waiver</span>(), <span class="at">date_labels =</span> <span class="fu">waiver</span>(), <span class="at">minor_breaks =</span> <span class="fu">waiver</span>(),</span>
<span id="cb574-7"><a href="ggplot2.html#cb574-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">date_minor_breaks =</span> <span class="fu">waiver</span>(), <span class="at">limits =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">waiver</span>())</span>
<span id="cb574-8"><a href="ggplot2.html#cb574-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-9"><a href="ggplot2.html#cb574-9" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_datetime</span>(<span class="at">name =</span> <span class="fu">waiver</span>(), <span class="at">breaks =</span> <span class="fu">waiver</span>(), <span class="at">date_breaks =</span> <span class="fu">waiver</span>(),</span>
<span id="cb574-10"><a href="ggplot2.html#cb574-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labels =</span> <span class="fu">waiver</span>(), <span class="at">date_labels =</span> <span class="fu">waiver</span>(), <span class="at">minor_breaks =</span> <span class="fu">waiver</span>(),</span>
<span id="cb574-11"><a href="ggplot2.html#cb574-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">date_minor_breaks =</span> <span class="fu">waiver</span>(), <span class="at">limits =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">waiver</span>())</span>
<span id="cb574-12"><a href="ggplot2.html#cb574-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-13"><a href="ggplot2.html#cb574-13" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_y_datetime</span>(<span class="at">name =</span> <span class="fu">waiver</span>(), <span class="at">breaks =</span> <span class="fu">waiver</span>(), <span class="at">date_breaks =</span> <span class="fu">waiver</span>(),</span>
<span id="cb574-14"><a href="ggplot2.html#cb574-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labels =</span> <span class="fu">waiver</span>(), <span class="at">date_labels =</span> <span class="fu">waiver</span>(), <span class="at">minor_breaks =</span> <span class="fu">waiver</span>(),</span>
<span id="cb574-15"><a href="ggplot2.html#cb574-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">date_minor_breaks =</span> <span class="fu">waiver</span>(), <span class="at">limits =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">waiver</span>())</span></code></pre></div>
<p>O <code>scale_*_date</code> é utilizado para variáveis do tipo <code>Date</code> e <code>scale_*_datetime</code> para variáveis do tipo <code>POSIXct</code>. A classe <code>POSIXct</code> aceita informações relacionadas a tempo/horário e a classe <code>Date</code> aceita apenas dia, mês e ano.</p>
<p>O mais importante é a possibilidade de alterar-se o modo como as datas são apresentadas a partir do argumento <code>date_labels</code>. Para isso, utilizaremos um exemplo a partir dos dados <code>economics</code>. Primeiro, observa-se o resultado padrão do ggplot2:</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="ggplot2.html#cb575-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(economics)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   date         pce    pop psavert uempmed unemploy
##   &lt;date&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
## 1 1967-07-01  507. 198712    12.6     4.5     2944
## 2 1967-08-01  510. 198911    12.6     4.7     2945
## 3 1967-09-01  516. 199113    11.9     4.6     2958
## 4 1967-10-01  512. 199311    12.9     4.9     3143
## 5 1967-11-01  517. 199498    12.8     4.7     3066
## 6 1967-12-01  525. 199657    11.8     4.8     3018</code></pre>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="ggplot2.html#cb577-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(economics, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> unemploy)) <span class="sc">+</span></span>
<span id="cb577-2"><a href="ggplot2.html#cb577-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() </span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-67-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Agora, suponha que queremos alterar o gráfico para o formato “Jan/1970”:</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="ggplot2.html#cb578-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(economics, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> unemploy)) <span class="sc">+</span></span>
<span id="cb578-2"><a href="ggplot2.html#cb578-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb578-3"><a href="ggplot2.html#cb578-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">&quot;%b/%Y&quot;</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-68-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>O <code>%b/%Y</code> é usado para definir-se o formato de data desejado. Para ver a lista de formatos, use <code>help(strptime)</code>. Para os <code>breaks</code>, temos duas opções: utilizar-se o argumento <code>breaks</code>, informando um vetor de datas, ou usar-se o argumento <code>date_breaks</code>, em que se informa a frequência dos breaks (por exemplo, “1 month” e “5 years”). Veja os exemplos abaixos:</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="ggplot2.html#cb579-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(economics, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> unemploy)) <span class="sc">+</span></span>
<span id="cb579-2"><a href="ggplot2.html#cb579-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb579-3"><a href="ggplot2.html#cb579-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">&quot;5 years&quot;</span>, <span class="at">date_labels =</span> <span class="st">&quot;%Y&quot;</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-69-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="ggplot2.html#cb580-1" aria-hidden="true" tabindex="-1"></a>seq_datas <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&#39;1970-01-01&#39;</span>),</span>
<span id="cb580-2"><a href="ggplot2.html#cb580-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">as.Date</span>(<span class="st">&#39;2015-04-01&#39;</span>),</span>
<span id="cb580-3"><a href="ggplot2.html#cb580-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">by =</span> <span class="st">&#39;5 years&#39;</span>)</span>
<span id="cb580-4"><a href="ggplot2.html#cb580-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(economics, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> unemploy)) <span class="sc">+</span></span>
<span id="cb580-5"><a href="ggplot2.html#cb580-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb580-6"><a href="ggplot2.html#cb580-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">breaks =</span> seq_datas, <span class="at">date_labels =</span> <span class="st">&quot;%Y&quot;</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-70-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="escalas-de-cores-color-e-preenchimento-fill" class="section level3" number="12.4.3">
<h3><span class="header-section-number">12.4.3</span> Escalas de Cores (color) e Preenchimento (fill)</h3>
<p>Como nos casos dos eixos <code>x</code> e <code>y</code>, o tipo da variável utilizada define qual o tipo de escala.</p>
<table>
<colgroup>
<col width="13%" />
<col width="10%" />
<col width="76%" />
</colgroup>
<thead>
<tr class="header">
<th>Tipo da Variável</th>
<th>Escala</th>
<th>Descrição</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Discreta</td>
<td><strong>hue</strong></td>
<td>escolhe n cores igualmente espaçadas em um disco de cores. É possível editar a luminosidade e a saturação.</td>
</tr>
<tr class="even">
<td></td>
<td>grey</td>
<td>escala de cinza</td>
</tr>
<tr class="odd">
<td></td>
<td>brewer</td>
<td>ver pacote RColorBrewer</td>
</tr>
<tr class="even">
<td></td>
<td>identity</td>
<td>usa as cores inseridas na própria variável</td>
</tr>
<tr class="odd">
<td></td>
<td>manual</td>
<td>escolhe as cores manualmente</td>
</tr>
<tr class="even">
<td>Contínua</td>
<td><strong>gradient</strong></td>
<td>cria um gradiente de duas cores (low-high)</td>
</tr>
<tr class="odd">
<td></td>
<td>gradient2</td>
<td>cria um gradiente de cores divergentes (low-mid-high)</td>
</tr>
<tr class="even">
<td></td>
<td>gradientn</td>
<td>cria um gradiente com n cores</td>
</tr>
</tbody>
</table>
<p>A opção <code>hue</code> usa a seguinte roda de cores:</p>
<div class="figure" style="text-align: center"><span id="fig:12-ggplot2-71"></span>
<img src="cdr-intro_files/figure-html/12-ggplot2-71-1.png" alt="Roda de Cores - hue" width="100%" />
<p class="caption">
Figura 12.1: Roda de Cores - hue
</p>
</div>
<p>A opção brewer pode usar as paletas de cores disponíveis no pacote RColorBrewer.</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="ggplot2.html#cb581-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb581-2"><a href="ggplot2.html#cb581-2" aria-hidden="true" tabindex="-1"></a><span class="fu">display.brewer.all</span>(<span class="at">n=</span><span class="cn">NULL</span>, <span class="at">type=</span><span class="st">&quot;all&quot;</span>, <span class="at">select=</span><span class="cn">NULL</span>, <span class="at">exact.n=</span><span class="cn">TRUE</span>,</span>
<span id="cb581-3"><a href="ggplot2.html#cb581-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">colorblindFriendly=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="images/brewer_pal.png" width="100%" style="display: block; margin: auto;" /></p>
<p>No exemplo abaixo, vamos utilizar a função <code>brewer.pal</code>, que retorna um vetor de cores de alguma paleta do pacote RColorBrewer. O objeto <code>paleta.gradientn</code> recebe nove cores da paleta <code>Reds</code>. Essas cores são utilizadas na função <code>scale_fill_gradientn()</code>.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="ggplot2.html#cb582-1" aria-hidden="true" tabindex="-1"></a>matriz_correl_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb582-2"><a href="ggplot2.html#cb582-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> var1, <span class="at">y =</span> var2, <span class="at">fill =</span> correlacao)) <span class="sc">+</span></span>
<span id="cb582-3"><a href="ggplot2.html#cb582-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb582-4"><a href="ggplot2.html#cb582-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb582-5"><a href="ggplot2.html#cb582-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">&quot;RdYlGn&quot;</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-75-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Alguns pacotes também fornecem escalas de cores próprias, como é o caso do pacote <code>viridis</code>.</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="ggplot2.html#cb583-1" aria-hidden="true" tabindex="-1"></a>matriz_correl_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb583-2"><a href="ggplot2.html#cb583-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> var1, <span class="at">y =</span> var2, <span class="at">fill =</span> correlacao)) <span class="sc">+</span></span>
<span id="cb583-3"><a href="ggplot2.html#cb583-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb583-4"><a href="ggplot2.html#cb583-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb583-5"><a href="ggplot2.html#cb583-5" aria-hidden="true" tabindex="-1"></a>  viridis<span class="sc">::</span><span class="fu">scale_fill_viridis</span>() </span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-76-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="subplots-facet" class="section level2" number="12.5">
<h2><span class="header-section-number">12.5</span> Subplots (facet)</h2>
<p><em>facets</em> são um excelente recurso do ggplot2 que permitem segmentar um gráfico em subgráficos de acordo com uma variável categórica.</p>
<p>Existem duas maneiras de definir <em>facets</em> no <code>ggplot2</code>: <code>facet_wrap()</code>, ideal para apenas uma variável, e <code>facet_grid()</code> ideal para uma combinação de duas variáveis.</p>
<p>Já vimos como acrescentar a informação do continente em um gráfico de pontos mudando o atributo <em>color</em>. Uma alternativa é criar um subgráfico para cada continente por meio de <em>facets.</em></p>
<ul>
<li>Painéis em formato de grid:</li>
</ul>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="ggplot2.html#cb584-1" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_grid</span>(facets, <span class="at">margins =</span> <span class="cn">FALSE</span>, <span class="at">scales =</span> <span class="st">&quot;fixed&quot;</span>, <span class="at">space =</span> <span class="st">&quot;fixed&quot;</span>, <span class="at">shrink =</span> <span class="cn">TRUE</span>,</span>
<span id="cb584-2"><a href="ggplot2.html#cb584-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">labeller =</span> <span class="st">&quot;label_value&quot;</span>, <span class="at">as.table =</span> <span class="cn">TRUE</span>, <span class="at">switch =</span> <span class="cn">NULL</span>, <span class="at">drop =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<ul>
<li>Converte painéis de uma dimensão para duas dimensões:</li>
</ul>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="ggplot2.html#cb585-1" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_wrap</span>(facets, <span class="at">nrow =</span> <span class="cn">NULL</span>, <span class="at">ncol =</span> <span class="cn">NULL</span>, <span class="at">scales =</span> <span class="st">&quot;fixed&quot;</span>, <span class="at">shrink =</span> <span class="cn">TRUE</span>,</span>
<span id="cb585-2"><a href="ggplot2.html#cb585-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">labeller =</span> <span class="st">&quot;label_value&quot;</span>, <span class="at">as.table =</span> <span class="cn">TRUE</span>, <span class="at">switch =</span> <span class="cn">NULL</span>, <span class="at">drop =</span> <span class="cn">TRUE</span>,</span>
<span id="cb585-3"><a href="ggplot2.html#cb585-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">dir =</span> <span class="st">&quot;h&quot;</span>)</span></code></pre></div>
<p>Antes de mais nada, vamos criar um exemplo para o <code>facet_wrap()</code>:</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="ggplot2.html#cb586-1" aria-hidden="true" tabindex="-1"></a>df_2017 <span class="sc">%&gt;%</span> </span>
<span id="cb586-2"><a href="ggplot2.html#cb586-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita,</span>
<span id="cb586-3"><a href="ggplot2.html#cb586-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb586-4"><a href="ggplot2.html#cb586-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb586-5"><a href="ggplot2.html#cb586-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(continent))</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-79-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Usamos a sintaxe <code>vars(coluna)</code>. Ou seja, indicamos que queremos quebrar os gráficos pela variável <code>continent</code>.</p>
<p>O ggplot2 determinou automaticamente o número de colunas e linhas e fixou as escalas dos eixos. No entanto, podemos definir o número de linhas ou colunas a partir dos argumentos <code>nrow</code> e <code>ncol</code>. Também é possível definir-se que cada gráfico tenha sua escala. No exemplo abaixo, deixaremos a escala do eixo y livre.</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="ggplot2.html#cb588-1" aria-hidden="true" tabindex="-1"></a>df_2017 <span class="sc">%&gt;%</span> </span>
<span id="cb588-2"><a href="ggplot2.html#cb588-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita,</span>
<span id="cb588-3"><a href="ggplot2.html#cb588-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb588-4"><a href="ggplot2.html#cb588-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb588-5"><a href="ggplot2.html#cb588-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(continent), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-80-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Caso se deseja utilizar mais de uma variável para criar os <em>facets</em>, usa-se a função <code>facet_grid()</code>:</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="ggplot2.html#cb590-1" aria-hidden="true" tabindex="-1"></a>df_feliz <span class="sc">%&gt;%</span> </span>
<span id="cb590-2"><a href="ggplot2.html#cb590-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filtrar os anos de 2015 a 2017</span></span>
<span id="cb590-3"><a href="ggplot2.html#cb590-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">between</span>(year, <span class="dv">2015</span>, <span class="dv">2017</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb590-4"><a href="ggplot2.html#cb590-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita,</span>
<span id="cb590-5"><a href="ggplot2.html#cb590-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb590-6"><a href="ggplot2.html#cb590-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb590-7"><a href="ggplot2.html#cb590-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(continent), <span class="at">rows =</span>  <span class="fu">vars</span>(year))</span></code></pre></div>
<pre><code>## Warning: Removed 11 rows containing missing values (geom_point).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-81-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="temas" class="section level2" number="12.6">
<h2><span class="header-section-number">12.6</span> Temas</h2>
<p>O ggplot2 fornece alguns temas prontos. Todavia, o usuário pode alterar manualmente cada detalhe de um gráfico ou criar um tema que será utilizado em outras visualizações. Para editar o tema, será usada a função <code>theme()</code>. Nesta função, poderão ser alterados os elementos do tema, como a cor de fundo do painel, o tamanho da fonte do eixo x, a posição da legenda etc. A lista de elementos está disponível <a href="http://docs.ggplot2.org/current/theme.html">neste link</a>.</p>
<p>Para cada elemento do tema, um tipo de objeto é esperado para realizar alterações. Por exemplo, para alterar-se o estilo do título do eixo x (<code>axis.title.x</code>) é preciso passar-se a função <code>element_text()</code>, que possui diversos parâmetros (família da fonte, tipo da fonte, cor, tamanho, alinhamento etc.). Além do <code>element_text()</code>, as principais funções para alterar-se elementos do tema são <code>element_line()</code>, <code>element_rect()</code> e <code>element_blank()</code>. O <code>element_blank()</code> é usado a fim de que nada seja desenhado para o elemento que recebe esta função.</p>
<p>Em um primeiro momento, pode parecer complicado alterar o tema via código, porém, conforme o usuário for praticando, essas alterações ficarão mais intuitivas. De toda forma, existe um addin para o RStudio que ajuda a customizar-se um gráfico do ggplot2 a partir de uma interface de <em>point and click</em>. Para instalá-lo, faça o seguinte:</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="ggplot2.html#cb592-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&#39;ggThemeAssist&#39;</span>)</span></code></pre></div>
<p>Para exemplificar a alteração do tema manualmente:</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="ggplot2.html#cb593-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_2017, <span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita, </span>
<span id="cb593-2"><a href="ggplot2.html#cb593-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb593-3"><a href="ggplot2.html#cb593-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb593-4"><a href="ggplot2.html#cb593-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>), </span>
<span id="cb593-5"><a href="ggplot2.html#cb593-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;gray80&quot;</span>), </span>
<span id="cb593-6"><a href="ggplot2.html#cb593-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb593-7"><a href="ggplot2.html#cb593-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;gray100&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-83-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div id="temas-disponíveis-no-ggplot2" class="section level3" number="12.6.1">
<h3><span class="header-section-number">12.6.1</span> Temas disponíveis no ggplot2</h3>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="ggplot2.html#cb595-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_2017, <span class="fu">aes</span>(<span class="at">x =</span> log_gdp_per_capita, </span>
<span id="cb595-2"><a href="ggplot2.html#cb595-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> life_expec)) <span class="sc">+</span></span>
<span id="cb595-3"><a href="ggplot2.html#cb595-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb595-4"><a href="ggplot2.html#cb595-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-5"><a href="ggplot2.html#cb595-5" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_gray</span>() <span class="sc">+</span></span>
<span id="cb595-6"><a href="ggplot2.html#cb595-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;theme_gray()&quot;</span>)</span>
<span id="cb595-7"><a href="ggplot2.html#cb595-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-8"><a href="ggplot2.html#cb595-8" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb595-9"><a href="ggplot2.html#cb595-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;theme_bw()&quot;</span>)</span>
<span id="cb595-10"><a href="ggplot2.html#cb595-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-11"><a href="ggplot2.html#cb595-11" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb595-12"><a href="ggplot2.html#cb595-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;theme_linedraw()&quot;</span>)</span>
<span id="cb595-13"><a href="ggplot2.html#cb595-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-14"><a href="ggplot2.html#cb595-14" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb595-15"><a href="ggplot2.html#cb595-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;theme_light()&quot;</span>)</span>
<span id="cb595-16"><a href="ggplot2.html#cb595-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-17"><a href="ggplot2.html#cb595-17" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb595-18"><a href="ggplot2.html#cb595-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;theme_minimal()&quot;</span>)</span>
<span id="cb595-19"><a href="ggplot2.html#cb595-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-20"><a href="ggplot2.html#cb595-20" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb595-21"><a href="ggplot2.html#cb595-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;theme_classic()&quot;</span>)</span>
<span id="cb595-22"><a href="ggplot2.html#cb595-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-23"><a href="ggplot2.html#cb595-23" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_dark</span>() <span class="sc">+</span></span>
<span id="cb595-24"><a href="ggplot2.html#cb595-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;theme_dark()&quot;</span>)</span>
<span id="cb595-25"><a href="ggplot2.html#cb595-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-26"><a href="ggplot2.html#cb595-26" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb595-27"><a href="ggplot2.html#cb595-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;theme_void()&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).

## Warning: Removed 6 rows containing missing values (geom_point).

## Warning: Removed 6 rows containing missing values (geom_point).

## Warning: Removed 6 rows containing missing values (geom_point).

## Warning: Removed 6 rows containing missing values (geom_point).

## Warning: Removed 6 rows containing missing values (geom_point).

## Warning: Removed 6 rows containing missing values (geom_point).

## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-85-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="temas-no-pacote-ggthemes" class="section level3" number="12.6.2">
<h3><span class="header-section-number">12.6.2</span> Temas no pacote ggthemes</h3>
<p>O pacote <a href="https://github.com/jrnold/ggthemes"><code>ggthemes</code></a> disponibiliza um conjunto de temas e escalas de cores. Vamos apresentar alguns temas disponíveis:</p>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).

## Warning: Removed 6 rows containing missing values (geom_point).

## Warning: Removed 6 rows containing missing values (geom_point).

## Warning: Removed 6 rows containing missing values (geom_point).

## Warning: Removed 6 rows containing missing values (geom_point).

## Warning: Removed 6 rows containing missing values (geom_point).

## Warning: Removed 6 rows containing missing values (geom_point).

## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-86-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="setando-o-tema-globalmente" class="section level3" number="12.6.3">
<h3><span class="header-section-number">12.6.3</span> Setando o tema globalmente</h3>
<p>Com o comando abaixo, todos os gráficos do seu script terão o mesmo tema:</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="ggplot2.html#cb598-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>(<span class="at">plot_title_size =</span> <span class="dv">12</span>,</span>
<span id="cb598-2"><a href="ggplot2.html#cb598-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis_title_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb598-3"><a href="ggplot2.html#cb598-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>)))</span></code></pre></div>
</div>
</div>
<div id="legendas" class="section level2" number="12.7">
<h2><span class="header-section-number">12.7</span> Legendas</h2>
<p>A melhor maneira de alterar as legendas de um gráfico do ggplot2, dando nomes mais amigáveis, é por meio da função <code>labs()</code>.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="ggplot2.html#cb599-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> </span>
<span id="cb599-2"><a href="ggplot2.html#cb599-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Log da PIB per capita&quot;</span>,</span>
<span id="cb599-3"><a href="ggplot2.html#cb599-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Expectativida de vida em anos&quot;</span>,</span>
<span id="cb599-4"><a href="ggplot2.html#cb599-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Relação entre PIB per capita e expectativida de vida&quot;</span>,</span>
<span id="cb599-5"><a href="ggplot2.html#cb599-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Existe uma correlação positiva entre as duas variáveis&quot;</span>,</span>
<span id="cb599-6"><a href="ggplot2.html#cb599-6" aria-hidden="true" tabindex="-1"></a>       <span class="co"># Aqui usamos &#39;\n&#39;, um character especial do R, para</span></span>
<span id="cb599-7"><a href="ggplot2.html#cb599-7" aria-hidden="true" tabindex="-1"></a>       <span class="co"># adicioanar uma quebra de linha </span></span>
<span id="cb599-8"><a href="ggplot2.html#cb599-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Continente</span><span class="sc">\n</span><span class="st"> do país&quot;</span>,</span>
<span id="cb599-9"><a href="ggplot2.html#cb599-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Autor: Eu&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-90-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="mapas-plotando-polígonos" class="section level2" number="12.8">
<h2><span class="header-section-number">12.8</span> Mapas: plotando polígonos</h2>
<p>Produzir mapas com o R nunca foi tão fácil como hoje, graças a avanços recentes dos pacotes <code>sf</code> e <code>ggplot2</code>. Foge muito do escopo deste curso explicar a estrutura de dados espaciais, como shapefiles. Mesmo sem esse entedimento, porém, é possível fazer gráficos com mapas de maneira muito simples.</p>
<p>O pacote <a href="https://github.com/ipeaGIT/geobr"><code>geobr</code></a>, desenvolvido pelo brasileiro Ítalo Cegatta, facilita a importação de arquivos shapefiles brasileiros.</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="ggplot2.html#cb601-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importar shapefiles de estados brasileiros</span></span>
<span id="cb601-2"><a href="ggplot2.html#cb601-2" aria-hidden="true" tabindex="-1"></a>geo_ufs <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_state</span>(<span class="at">code_state =</span> <span class="st">&#39;all&#39;</span>, <span class="at">year =</span> <span class="dv">2018</span>)</span></code></pre></div>
<pre><code>## Using year 2018</code></pre>
<pre><code>## Loading data for the whole country</code></pre>
<pre><code>## 
  |                                                                                                           
  |                                                                                                     |   0%
  |                                                                                                           
  |====                                                                                                 |   4%
  |                                                                                                           
  |=======                                                                                              |   7%
  |                                                                                                           
  |===========                                                                                          |  11%
  |                                                                                                           
  |===============                                                                                      |  15%
  |                                                                                                           
  |===================                                                                                  |  19%
  |                                                                                                           
  |======================                                                                               |  22%
  |                                                                                                           
  |==========================                                                                           |  26%
  |                                                                                                           
  |==============================                                                                       |  30%
  |                                                                                                           
  |==================================                                                                   |  33%
  |                                                                                                           
  |=====================================                                                                |  37%
  |                                                                                                           
  |=========================================                                                            |  41%
  |                                                                                                           
  |=============================================                                                        |  44%
  |                                                                                                           
  |=================================================                                                    |  48%
  |                                                                                                           
  |====================================================                                                 |  52%
  |                                                                                                           
  |========================================================                                             |  56%
  |                                                                                                           
  |============================================================                                         |  59%
  |                                                                                                           
  |================================================================                                     |  63%
  |                                                                                                           
  |===================================================================                                  |  67%
  |                                                                                                           
  |=======================================================================                              |  70%
  |                                                                                                           
  |===========================================================================                          |  74%
  |                                                                                                           
  |===============================================================================                      |  78%
  |                                                                                                           
  |==================================================================================                   |  81%
  |                                                                                                           
  |======================================================================================               |  85%
  |                                                                                                           
  |==========================================================================================           |  89%
  |                                                                                                           
  |==============================================================================================       |  93%
  |                                                                                                           
  |=================================================================================================    |  96%
  |                                                                                                           
  |=====================================================================================================| 100%</code></pre>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="ggplot2.html#cb605-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(geo_ufs)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 5 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -73.99045 ymin: -13.6937 xmax: -46.06151 ymax: 5.271841
## Geodetic CRS:  SIRGAS 2000
##   code_state abbrev_state name_state code_region name_region                           geom
## 1         11           RO   Rondônia           1       Norte MULTIPOLYGON (((-62.89216 -...
## 2         12           AC       Acre           1       Norte MULTIPOLYGON (((-71.07772 -...
## 3         13           AM   Amazonas           1       Norte MULTIPOLYGON (((-69.61341 -...
## 4         14           RR    Roraima           1       Norte MULTIPOLYGON (((-63.97805 2...
## 5         15           PA       Pará           1       Norte MULTIPOLYGON (((-46.38475 -...
## 6         16           AP      Amapá           1       Norte MULTIPOLYGON (((-53.27918 2...</code></pre>
<p>Observe que o dataframe possui cinco colunas, sendo a última relacionada às informações espaciais sobre os polígonos dos estados que serão usadas para construir os mapas.</p>
<p>A sintaxe do ggplot2 para construir mapas é relativamente diferente: não é preciso definir nenhuma <em>aesthetic</em>, pois a função <code>geom_sf</code> internamente busca a coluna de polígonos presente no objeto:</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="ggplot2.html#cb607-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(geo_ufs) <span class="sc">+</span></span>
<span id="cb607-2"><a href="ggplot2.html#cb607-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># a linha abaixo da no mesmo que geom_sf(aes(geometry = geom))</span></span>
<span id="cb607-3"><a href="ggplot2.html#cb607-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-93-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>A partir do gráfico base criado acima, as customizações seguem o padrão do ggplot2. Por exemplo, é possível mapear a cor os polígonos de acordo com uma variável presente nos dados, além de alterar aspectos visuais com a função <code>theme</code>:</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="ggplot2.html#cb608-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(geo_ufs) <span class="sc">+</span></span>
<span id="cb608-2"><a href="ggplot2.html#cb608-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># a linha abaixo da no mesmo que geom_sf(aes(geometry = geometry))</span></span>
<span id="cb608-3"><a href="ggplot2.html#cb608-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">geometry =</span> geom,</span>
<span id="cb608-4"><a href="ggplot2.html#cb608-4" aria-hidden="true" tabindex="-1"></a>              <span class="co"># colorir os poligonos de acordo com sua regiao</span></span>
<span id="cb608-5"><a href="ggplot2.html#cb608-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="fu">as.character</span>(code_region))) <span class="sc">+</span></span>
<span id="cb608-6"><a href="ggplot2.html#cb608-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># deixar o mapa mais limpo e sem eixos</span></span>
<span id="cb608-7"><a href="ggplot2.html#cb608-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb608-8"><a href="ggplot2.html#cb608-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb608-9"><a href="ggplot2.html#cb608-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>),</span>
<span id="cb608-10"><a href="ggplot2.html#cb608-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb608-11"><a href="ggplot2.html#cb608-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()</span>
<span id="cb608-12"><a href="ggplot2.html#cb608-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb608-13"><a href="ggplot2.html#cb608-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mudar titulo da legenda</span></span>
<span id="cb608-14"><a href="ggplot2.html#cb608-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Região&quot;</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-94-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="alert alert-info"
<strong>Referências:</strong>  
[geom_sf()](https://ggplot2.tidyverse.org/reference/ggsf.html)   
[Tutorial de geom_sf()](https://dcl-2017-01.github.io/curriculum/notes/spatial-vis.html)  
</div>
<div id="projeto-plotando-indicadores-socioeconômicos-em-um-mapa." class="section level3" number="12.8.1">
<h3><span class="header-section-number">12.8.1</span> Projeto: plotando indicadores socioeconômicos em um mapa.</h3>
<p>Neste exemplo, mostramos como o <code>ggplot2</code> pode ser usado para produzir mapas muito informativos, mapeando a cor de cada polígono a uma variável numérica, como PIB ou população.</p>
<p>Observe o passo-a-passo de coleta e transformação dos dados do PIB per capita dos municípios brasileiros:</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="ggplot2.html#cb609-1" aria-hidden="true" tabindex="-1"></a><span class="co"># origem do conjunto de dados:</span></span>
<span id="cb609-2"><a href="ggplot2.html#cb609-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ftp://ftp.ibge.gov.br/Pib_Municipios/2017/base/base_de_dados_2010_2017_xls.zip</span></span>
<span id="cb609-3"><a href="ggplot2.html#cb609-3" aria-hidden="true" tabindex="-1"></a><span class="co"># baixe o arquivo, descompacte, abra no excel ou no libre office e salve como xlsx</span></span>
<span id="cb609-4"><a href="ggplot2.html#cb609-4" aria-hidden="true" tabindex="-1"></a><span class="co"># o R não consegue ler arquivos xls</span></span>
<span id="cb609-5"><a href="ggplot2.html#cb609-5" aria-hidden="true" tabindex="-1"></a>df_pib <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&#39;dados/base_de_dados_2010_2017_xls/PIB dos Municípios - base de dados 2010-2017.xlsx&#39;</span>)</span>
<span id="cb609-6"><a href="ggplot2.html#cb609-6" aria-hidden="true" tabindex="-1"></a><span class="co"># limpar nomes das colunas</span></span>
<span id="cb609-7"><a href="ggplot2.html#cb609-7" aria-hidden="true" tabindex="-1"></a>df_pib <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(df_pib)</span>
<span id="cb609-8"><a href="ggplot2.html#cb609-8" aria-hidden="true" tabindex="-1"></a><span class="co"># observe os dados:</span></span>
<span id="cb609-9"><a href="ggplot2.html#cb609-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df_pib)</span></code></pre></div>
<pre><code>## Rows: 44,545
## Columns: 43
## $ ano                                                                                                                                      &lt;dbl&gt; …
## $ codigo_da_grande_regiao                                                                                                                  &lt;dbl&gt; …
## $ nome_da_grande_regiao                                                                                                                    &lt;chr&gt; …
## $ codigo_da_unidade_da_federacao                                                                                                           &lt;dbl&gt; …
## $ sigla_da_unidade_da_federacao                                                                                                            &lt;chr&gt; …
## $ nome_da_unidade_da_federacao                                                                                                             &lt;chr&gt; …
## $ codigo_do_municipio                                                                                                                      &lt;dbl&gt; …
## $ nome_do_municipio                                                                                                                        &lt;chr&gt; …
## $ regiao_metropolitana                                                                                                                     &lt;chr&gt; …
## $ codigo_da_mesorregiao                                                                                                                    &lt;dbl&gt; …
## $ nome_da_mesorregiao                                                                                                                      &lt;chr&gt; …
## $ codigo_da_microrregiao                                                                                                                   &lt;dbl&gt; …
## $ nome_da_microrregiao                                                                                                                     &lt;chr&gt; …
## $ codigo_da_regiao_geografica_imediata                                                                                                     &lt;dbl&gt; …
## $ nome_da_regiao_geografica_imediata                                                                                                       &lt;chr&gt; …
## $ municipio_da_regiao_geografica_imediata                                                                                                  &lt;chr&gt; …
## $ codigo_da_regiao_geografica_intermediaria                                                                                                &lt;dbl&gt; …
## $ nome_da_regiao_geografica_intermediaria                                                                                                  &lt;chr&gt; …
## $ municipio_da_regiao_geografica_intermediaria                                                                                             &lt;chr&gt; …
## $ codigo_concentracao_urbana                                                                                                               &lt;dbl&gt; …
## $ nome_concentracao_urbana                                                                                                                 &lt;chr&gt; …
## $ tipo_concentracao_urbana                                                                                                                 &lt;chr&gt; …
## $ codigo_arranjo_populacional                                                                                                              &lt;dbl&gt; …
## $ nome_arranjo_populacional                                                                                                                &lt;chr&gt; …
## $ hierarquia_urbana                                                                                                                        &lt;chr&gt; …
## $ hierarquia_urbana_principais_categorias                                                                                                  &lt;chr&gt; …
## $ codigo_da_regiao_rural                                                                                                                   &lt;dbl&gt; …
## $ nome_da_regiao_rural                                                                                                                     &lt;chr&gt; …
## $ regiao_rural_segundo_classificacao_do_nucleo                                                                                             &lt;chr&gt; …
## $ amazonia_legal                                                                                                                           &lt;chr&gt; …
## $ semiarido                                                                                                                                &lt;chr&gt; …
## $ cidade_regiao_de_sao_paulo                                                                                                               &lt;chr&gt; …
## $ valor_adicionado_bruto_da_agropecuaria_a_precos_correntes_r_1_000                                                                        &lt;dbl&gt; …
## $ valor_adicionado_bruto_da_industria_a_precos_correntes_r_1_000                                                                           &lt;dbl&gt; …
## $ valor_adicionado_bruto_dos_servicos_a_precos_correntes_exceto_administracao_defesa_educacao_e_saude_publicas_e_seguridade_social_r_1_000 &lt;dbl&gt; …
## $ valor_adicionado_bruto_da_administracao_defesa_educacao_e_saude_publicas_e_seguridade_social_a_precos_correntes_r_1_000                  &lt;dbl&gt; …
## $ valor_adicionado_bruto_total_a_precos_correntes_r_1_000                                                                                  &lt;dbl&gt; …
## $ impostos_liquidos_de_subsidios_sobre_produtos_a_precos_correntes_r_1_000                                                                 &lt;dbl&gt; …
## $ produto_interno_bruto_a_precos_correntes_r_1_000                                                                                         &lt;dbl&gt; …
## $ produto_interno_bruto_per_capita_a_precos_correntes_r_1_00                                                                               &lt;dbl&gt; …
## $ atividade_com_maior_valor_adicionado_bruto                                                                                               &lt;chr&gt; …
## $ atividade_com_segundo_maior_valor_adicionado_bruto                                                                                       &lt;chr&gt; …
## $ atividade_com_terceiro_maior_valor_adicionado_bruto                                                                                      &lt;chr&gt; …</code></pre>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="ggplot2.html#cb611-1" aria-hidden="true" tabindex="-1"></a><span class="co"># agregando dados por estado, calculando o pib por cidade</span></span>
<span id="cb611-2"><a href="ggplot2.html#cb611-2" aria-hidden="true" tabindex="-1"></a>df_pib_uf <span class="ot">&lt;-</span> df_pib <span class="sc">%&gt;%</span> </span>
<span id="cb611-3"><a href="ggplot2.html#cb611-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filtrar 2017</span></span>
<span id="cb611-4"><a href="ggplot2.html#cb611-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ano <span class="sc">==</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb611-5"><a href="ggplot2.html#cb611-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filtrar fora DF</span></span>
<span id="cb611-6"><a href="ggplot2.html#cb611-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sigla_da_unidade_da_federacao <span class="sc">!=</span> <span class="st">&#39;DF&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb611-7"><a href="ggplot2.html#cb611-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(codigo_da_unidade_da_federacao) <span class="sc">%&gt;%</span> </span>
<span id="cb611-8"><a href="ggplot2.html#cb611-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">qtd_cidades =</span> <span class="fu">n</span>(),</span>
<span id="cb611-9"><a href="ggplot2.html#cb611-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">pib_uf =</span> <span class="fu">sum</span>(produto_interno_bruto_a_precos_correntes_r_1_000),</span>
<span id="cb611-10"><a href="ggplot2.html#cb611-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">pib_por_cidade =</span> pib_uf<span class="sc">/</span>qtd_cidades)</span>
<span id="cb611-11"><a href="ggplot2.html#cb611-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb611-12"><a href="ggplot2.html#cb611-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb611-13"><a href="ggplot2.html#cb611-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_pib_uf)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   codigo_da_unidade_da_federacao qtd_cidades     pib_uf pib_por_cidade
##                            &lt;dbl&gt;       &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;
## 1                             11          52  43506499.        836663.
## 2                             12          22  14271063.        648685.
## 3                             13          62  93204175.       1503293.
## 4                             14          15  12103236.        806882.
## 5                             15         144 155195371.       1077746.
## 6                             16          16  15479885.        967493.</code></pre>
<p>Com o dataframe de PIB por cidade criado, podemos o unir com o dataframe que contem os dados espaciais dos estados:</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="ggplot2.html#cb613-1" aria-hidden="true" tabindex="-1"></a>geo_uf_pib <span class="ot">&lt;-</span> <span class="fu">left_join</span>(geo_ufs, df_pib_uf, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;code_state&#39;</span> <span class="ot">=</span> <span class="st">&#39;codigo_da_unidade_da_federacao&#39;</span>))</span>
<span id="cb613-2"><a href="ggplot2.html#cb613-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb613-3"><a href="ggplot2.html#cb613-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb613-4"><a href="ggplot2.html#cb613-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(geo_uf_pib)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 8 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -73.99045 ymin: -13.6937 xmax: -46.06151 ymax: 5.271841
## Geodetic CRS:  SIRGAS 2000
##   code_state abbrev_state name_state code_region name_region qtd_cidades    pib_uf pib_por_cidade                           geom
## 1         11           RO   Rondônia           1       Norte          52  43506499       836663.4 MULTIPOLYGON (((-62.89216 -...
## 2         12           AC       Acre           1       Norte          22  14271063       648684.7 MULTIPOLYGON (((-71.07772 -...
## 3         13           AM   Amazonas           1       Norte          62  93204175      1503293.1 MULTIPOLYGON (((-69.61341 -...
## 4         14           RR    Roraima           1       Norte          15  12103236       806882.4 MULTIPOLYGON (((-63.97805 2...
## 5         15           PA       Pará           1       Norte         144 155195371      1077745.6 MULTIPOLYGON (((-46.38475 -...
## 6         16           AP      Amapá           1       Norte          16  15479885       967492.8 MULTIPOLYGON (((-53.27918 2...</code></pre>
<p>Enfim, podemos proceder com a criação do mapa:</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="ggplot2.html#cb615-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(geo_uf_pib) <span class="sc">+</span></span>
<span id="cb615-2"><a href="ggplot2.html#cb615-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">log</span>(pib_por_cidade))) <span class="sc">+</span></span>
<span id="cb615-3"><a href="ggplot2.html#cb615-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mudar escala de cores para sequencial vermelha</span></span>
<span id="cb615-4"><a href="ggplot2.html#cb615-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">type =</span> <span class="st">&quot;seq&quot;</span>,</span>
<span id="cb615-5"><a href="ggplot2.html#cb615-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">palette =</span> <span class="st">&quot;Greens&quot;</span>,</span>
<span id="cb615-6"><a href="ggplot2.html#cb615-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb615-7"><a href="ggplot2.html#cb615-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># deixar o mapa mais limpo e sem eixos</span></span>
<span id="cb615-8"><a href="ggplot2.html#cb615-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb615-9"><a href="ggplot2.html#cb615-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb615-10"><a href="ggplot2.html#cb615-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb615-11"><a href="ggplot2.html#cb615-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>),</span>
<span id="cb615-12"><a href="ggplot2.html#cb615-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb615-13"><a href="ggplot2.html#cb615-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()</span>
<span id="cb615-14"><a href="ggplot2.html#cb615-14" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb615-15"><a href="ggplot2.html#cb615-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;PIB por cidade&quot;</span>,</span>
<span id="cb615-16"><a href="ggplot2.html#cb615-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-98-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="salvando-gráficos" class="section level2" number="12.9">
<h2><span class="header-section-number">12.9</span> Salvando Gráficos</h2>
<p>Há duas formas de salvar o gráfico gerado pelo ggplot2. A primeira delas é clicando no botão <strong>Export</strong> na aba <strong>Plots</strong>. Lá existirão três opções: exportar para o clipboard, salvar como PDF ou salvar como imagem.</p>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="ggplot2.html#cb616-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&#39;images/salvar_plot.gif&#39;</span>)</span></code></pre></div>
<p>A outra opção é usar a função <code>ggsave()</code>:</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="ggplot2.html#cb617-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(filename, <span class="at">plot =</span> <span class="fu">last_plot</span>(), <span class="at">device =</span> <span class="cn">NULL</span>, <span class="at">path =</span> <span class="cn">NULL</span>,</span>
<span id="cb617-2"><a href="ggplot2.html#cb617-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="dv">1</span>, <span class="at">width =</span> <span class="cn">NA</span>, <span class="at">height =</span> <span class="cn">NA</span>, <span class="at">units =</span> <span class="fu">c</span>(<span class="st">&quot;in&quot;</span>, <span class="st">&quot;cm&quot;</span>, <span class="st">&quot;mm&quot;</span>),</span>
<span id="cb617-3"><a href="ggplot2.html#cb617-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">limitsize =</span> <span class="cn">TRUE</span>, ...)</span></code></pre></div>
<p>O argumento <code>device</code> é usado para escolher-se o tipo de arquivo (“eps,” “ps,” “tex” (pictex), “pdf,” “jpeg,” “tiff,” “png,” “bmp,” “svg” or “wmf”).</p>
</div>
<div id="extensões-do-ggplot2" class="section level2" number="12.10">
<h2><span class="header-section-number">12.10</span> Extensões do ggplot2</h2>
<p>Um conjunto de pacotes fornece extensões ao ggplot2. Ou seja, cria funcionalidades não existentes no pacote original.</p>
<p>Veja <a href="http://www.ggplot2-exts.org/gallery/">neste link</a> uma galeria com as extensões. Aqui, exemplificaremos algumas:</p>
<div id="ggrepel" class="section level3" number="12.10.1">
<h3><span class="header-section-number">12.10.1</span> ggrepel</h3>
<p>O <code>ggrepel</code> é importante para evitar que textos (<code>geom_text</code>) e rótulos (<code>geom_label</code>) se sobreponham. Veja o mesmo gráfico sem e com o ggrepel:</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="ggplot2.html#cb618-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb618-2"><a href="ggplot2.html#cb618-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb618-3"><a href="ggplot2.html#cb618-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb618-4"><a href="ggplot2.html#cb618-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb618-5"><a href="ggplot2.html#cb618-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">rownames</span>(mtcars))) </span></code></pre></div>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-101-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="ggplot2.html#cb619-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb619-2"><a href="ggplot2.html#cb619-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb619-3"><a href="ggplot2.html#cb619-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb619-4"><a href="ggplot2.html#cb619-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb619-5"><a href="ggplot2.html#cb619-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">rownames</span>(mtcars))) </span></code></pre></div>
<pre><code>## Warning: ggrepel: 2 unlabeled data points (too many overlaps). Consider increasing max.overlaps</code></pre>
<p><img src="cdr-intro_files/figure-html/12-ggplot2-102-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="gganimate" class="section level3" number="12.10.2">
<h3><span class="header-section-number">12.10.2</span> gganimate</h3>
<p>Outra extensão muito interessante é o <code>gganimate</code>. Com esta extensão é possível criar gifs (animações) de gráficos do ggplot2. O ponto fundamental é definir-se uma variável que controlará os <code>frames</code>, ou seja, as imagens que serão sobrepostas para compor-se a animação.</p>
<p>Veja o exemplo abaixo:</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="ggplot2.html#cb621-1" aria-hidden="true" tabindex="-1"></a><span class="co"># O pacote não está no cran</span></span>
<span id="cb621-2"><a href="ggplot2.html#cb621-2" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github(&quot;dgrtwo/gganimate&quot;)</span></span>
<span id="cb621-3"><a href="ggplot2.html#cb621-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb621-4"><a href="ggplot2.html#cb621-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb621-5"><a href="ggplot2.html#cb621-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y =</span> lifeExp,</span>
<span id="cb621-6"><a href="ggplot2.html#cb621-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">size =</span> pop, <span class="at">color =</span> continent,</span>
<span id="cb621-7"><a href="ggplot2.html#cb621-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">frame =</span> year)) <span class="sc">+</span></span>
<span id="cb621-8"><a href="ggplot2.html#cb621-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb621-9"><a href="ggplot2.html#cb621-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span>
<span id="cb621-10"><a href="ggplot2.html#cb621-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb621-11"><a href="ggplot2.html#cb621-11" aria-hidden="true" tabindex="-1"></a>animation<span class="sc">::</span><span class="fu">ani.options</span>(<span class="at">interval =</span> <span class="dv">1</span>)</span>
<span id="cb621-12"><a href="ggplot2.html#cb621-12" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">gganimate</span>(p, <span class="at">filename =</span> <span class="st">&#39;images/gapminder1.gif&#39;</span>,</span>
<span id="cb621-13"><a href="ggplot2.html#cb621-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">ani.width =</span> <span class="dv">750</span>,</span>
<span id="cb621-14"><a href="ggplot2.html#cb621-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">ani.height =</span> <span class="dv">450</span>)</span></code></pre></div>
<p><img src="images/gapminder1.gif" width="100%" style="display: block; margin: auto;" /></p>
<p>É possível suavizar a animação com o pacote <code>tweenr</code>. É um pouco complicado, mas fica o exemplo abaixo retirado <a href="http://blog.revolutionanalytics.com/2017/05/tweenr.html">deste post</a>:</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="ggplot2.html#cb622-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tweenr)</span>
<span id="cb622-2"><a href="ggplot2.html#cb622-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb622-3"><a href="ggplot2.html#cb622-3" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">unique</span>(gapminder<span class="sc">$</span>year)</span>
<span id="cb622-4"><a href="ggplot2.html#cb622-4" aria-hidden="true" tabindex="-1"></a>gapminder_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb622-5"><a href="ggplot2.html#cb622-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(years)){</span>
<span id="cb622-6"><a href="ggplot2.html#cb622-6" aria-hidden="true" tabindex="-1"></a>  j <span class="ot">&lt;-</span> years[i]</span>
<span id="cb622-7"><a href="ggplot2.html#cb622-7" aria-hidden="true" tabindex="-1"></a>  gapminder_list[[i]] <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb622-8"><a href="ggplot2.html#cb622-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> j)</span>
<span id="cb622-9"><a href="ggplot2.html#cb622-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb622-10"><a href="ggplot2.html#cb622-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb622-11"><a href="ggplot2.html#cb622-11" aria-hidden="true" tabindex="-1"></a>tf <span class="ot">&lt;-</span> <span class="fu">tween_states</span>(gapminder_list,</span>
<span id="cb622-12"><a href="ggplot2.html#cb622-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tweenlength =</span> <span class="dv">2</span>,</span>
<span id="cb622-13"><a href="ggplot2.html#cb622-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">statelength =</span> <span class="dv">0</span>,</span>
<span id="cb622-14"><a href="ggplot2.html#cb622-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ease =</span> <span class="fu">rep</span>(<span class="st">&quot;linear&quot;</span>, <span class="fu">length</span>(gapminder_list)),</span>
<span id="cb622-15"><a href="ggplot2.html#cb622-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nframes =</span> <span class="dv">308</span>)</span>
<span id="cb622-16"><a href="ggplot2.html#cb622-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb622-17"><a href="ggplot2.html#cb622-17" aria-hidden="true" tabindex="-1"></a>tf2 <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">y =</span> <span class="dv">80</span>, <span class="at">x =</span> <span class="dv">10</span><span class="sc">^</span>(<span class="fl">2.5</span>), <span class="at">year =</span> <span class="fu">seq</span>(<span class="dv">1957</span>, <span class="dv">2007</span>, <span class="dv">5</span>))</span>
<span id="cb622-18"><a href="ggplot2.html#cb622-18" aria-hidden="true" tabindex="-1"></a>tf2 <span class="ot">&lt;-</span> <span class="fu">split</span>(tf2, tf2<span class="sc">$</span>year)</span>
<span id="cb622-19"><a href="ggplot2.html#cb622-19" aria-hidden="true" tabindex="-1"></a>tf2 <span class="ot">&lt;-</span> <span class="fu">tween_states</span>(tf2,</span>
<span id="cb622-20"><a href="ggplot2.html#cb622-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tweenlength =</span> <span class="dv">2</span>,</span>
<span id="cb622-21"><a href="ggplot2.html#cb622-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">statelength =</span> <span class="dv">0</span>,</span>
<span id="cb622-22"><a href="ggplot2.html#cb622-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ease =</span> <span class="fu">rep</span>(<span class="st">&quot;linear&quot;</span>, <span class="fu">length</span>(tf2)),</span>
<span id="cb622-23"><a href="ggplot2.html#cb622-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nframes =</span> <span class="dv">308</span>)</span>
<span id="cb622-24"><a href="ggplot2.html#cb622-24" aria-hidden="true" tabindex="-1"></a>tf2 <span class="ot">&lt;-</span> tf2 <span class="sc">%&gt;%</span> </span>
<span id="cb622-25"><a href="ggplot2.html#cb622-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">1957</span>, <span class="dv">2007</span>, <span class="dv">5</span>), <span class="at">each =</span> <span class="dv">29</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">310</span>])</span>
<span id="cb622-26"><a href="ggplot2.html#cb622-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb622-27"><a href="ggplot2.html#cb622-27" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tf,</span>
<span id="cb622-28"><a href="ggplot2.html#cb622-28" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x=</span>gdpPercap, <span class="at">y=</span>lifeExp, <span class="at">frame =</span> .frame)) <span class="sc">+</span></span>
<span id="cb622-29"><a href="ggplot2.html#cb622-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size=</span>pop, <span class="at">color=</span>continent), <span class="at">alpha=</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb622-30"><a href="ggplot2.html#cb622-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> tf2, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> year)) <span class="sc">+</span></span>
<span id="cb622-31"><a href="ggplot2.html#cb622-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;GDP per capita&quot;</span>) <span class="sc">+</span></span>
<span id="cb622-32"><a href="ggplot2.html#cb622-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Life expectancy at birth&quot;</span>) <span class="sc">+</span></span>
<span id="cb622-33"><a href="ggplot2.html#cb622-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span>
<span id="cb622-34"><a href="ggplot2.html#cb622-34" aria-hidden="true" tabindex="-1"></a>animation<span class="sc">::</span><span class="fu">ani.options</span>(<span class="at">interval =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">20</span>)</span>
<span id="cb622-35"><a href="ggplot2.html#cb622-35" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">gganimate</span>(p2, <span class="at">filename =</span> <span class="st">&#39;images/gapminder2.gif&#39;</span>,</span>
<span id="cb622-36"><a href="ggplot2.html#cb622-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">ani.width =</span> <span class="dv">750</span>,</span>
<span id="cb622-37"><a href="ggplot2.html#cb622-37" aria-hidden="true" tabindex="-1"></a>               <span class="at">ani.height =</span> <span class="dv">450</span>,</span>
<span id="cb622-38"><a href="ggplot2.html#cb622-38" aria-hidden="true" tabindex="-1"></a>               <span class="at">title_frame =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="images/gapminder2.gif" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="exercícios-6" class="section level2" number="12.11">
<h2><span class="header-section-number">12.11</span> Exercícios</h2>
<div id="parte-1-1" class="section level3" number="12.11.1">
<h3><span class="header-section-number">12.11.1</span> Parte 1</h3>
<ol style="list-style-type: decimal">
<li><p>Crie um gráfico de dispersão utilizando a base <code>gapminder</code> para o ano de 2007. Mapeie uma variável para o tamanho do ponto e adicione os títulos do gráfico e dos eixos.</p></li>
<li><p>No gráfico anterior, como você faria para que o ponto do Brasil fosse identificado com uma cor adicional? Dica: se uma nova camada usar um segundo conjunto de dados é preciso informar usando o argumento <code>data</code>. Exemplo: <code>geom_point(data = novo_data_frame, ...)</code>.</p></li>
<li><p>Crie um histograma da variável <code>wage</code> a partir da base de dados <code>Wage</code> do pacote <code>ISLR</code>. Crie uma visualização da distribuição da variável <code>wage</code> por nível da variável education. Mapeie a variável education para o elemento estético <code>fill</code>.</p></li>
<li><p>Crie um data.frame chamado <code>Wage2</code> em que a variável <code>education</code> é removida. Adicione a seguinte camada no início do código:</p></li>
</ol>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="ggplot2.html#cb623-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_histogram</span>(<span class="at">data =</span> Wage2, <span class="at">fill =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p>Veja e interprete o resultado.</p>
<ol start="5" style="list-style-type: decimal">
<li>A partir do código abaixo, crie um gráfico que apresenta os dez países que tiveram maior crescimento do PIB em 2016 e aqueles dez que tiveram o menor. Use o <code>facet_wrap</code> para quebrar a visualização em dois gráficos. Escolha o objeto geométrico <code>geom_col</code> ou <code>geom_point()</code>.</li>
</ol>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="ggplot2.html#cb624-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WDI)</span>
<span id="cb624-2"><a href="ggplot2.html#cb624-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb624-3"><a href="ggplot2.html#cb624-3" aria-hidden="true" tabindex="-1"></a>gdp_growth <span class="ot">&lt;-</span> <span class="fu">WDI</span>(<span class="at">indicator =</span> <span class="st">&quot;NY.GDP.MKTP.KD.ZG&quot;</span>,</span>
<span id="cb624-4"><a href="ggplot2.html#cb624-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="dv">2016</span>,</span>
<span id="cb624-5"><a href="ggplot2.html#cb624-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">end =</span> <span class="dv">2016</span>,</span>
<span id="cb624-6"><a href="ggplot2.html#cb624-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">extra =</span> <span class="cn">TRUE</span>)</span>
<span id="cb624-7"><a href="ggplot2.html#cb624-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb624-8"><a href="ggplot2.html#cb624-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove regiões - ISO&#39;s com números</span></span>
<span id="cb624-9"><a href="ggplot2.html#cb624-9" aria-hidden="true" tabindex="-1"></a>gdp_growth <span class="ot">&lt;-</span> gdp_growth <span class="sc">%&gt;%</span> </span>
<span id="cb624-10"><a href="ggplot2.html#cb624-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(region) <span class="sc">&amp;</span> region <span class="sc">!=</span> <span class="st">&quot;Aggregates&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(NY.GDP.MKTP.KD.ZG))</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Utilize o mapa mundi disponível no pacote <code>chropletrMaps</code> e os dados que criamos no exercício anterior para plotar as variações do PIB em um mapa.</li>
</ol>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="ggplot2.html#cb625-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(choroplethrMaps)</span>
<span id="cb625-2"><a href="ggplot2.html#cb625-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;country.map&quot;</span>)</span>
<span id="cb625-3"><a href="ggplot2.html#cb625-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb625-4"><a href="ggplot2.html#cb625-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dados - Crescimento do PIB em 2016</span></span>
<span id="cb625-5"><a href="ggplot2.html#cb625-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WDI)</span>
<span id="cb625-6"><a href="ggplot2.html#cb625-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb625-7"><a href="ggplot2.html#cb625-7" aria-hidden="true" tabindex="-1"></a>gdp_growth <span class="ot">&lt;-</span> <span class="fu">WDI</span>(<span class="at">indicator =</span> <span class="st">&quot;NY.GDP.MKTP.KD.ZG&quot;</span>,</span>
<span id="cb625-8"><a href="ggplot2.html#cb625-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="dv">2016</span>,</span>
<span id="cb625-9"><a href="ggplot2.html#cb625-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">end =</span> <span class="dv">2016</span>,</span>
<span id="cb625-10"><a href="ggplot2.html#cb625-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">extra =</span> <span class="cn">TRUE</span>)</span>
<span id="cb625-11"><a href="ggplot2.html#cb625-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb625-12"><a href="ggplot2.html#cb625-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove regiões - ISO&#39;s com números</span></span>
<span id="cb625-13"><a href="ggplot2.html#cb625-13" aria-hidden="true" tabindex="-1"></a>gdp_growth <span class="ot">&lt;-</span> gdp_growth <span class="sc">%&gt;%</span> </span>
<span id="cb625-14"><a href="ggplot2.html#cb625-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(region) <span class="sc">&amp;</span> region <span class="sc">!=</span> <span class="st">&quot;Aggregates&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(NY.GDP.MKTP.KD.ZG))</span>
<span id="cb625-15"><a href="ggplot2.html#cb625-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb625-16"><a href="ggplot2.html#cb625-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Continue fazendo o join entre country.map e gdp_growth</span></span>
<span id="cb625-17"><a href="ggplot2.html#cb625-17" aria-hidden="true" tabindex="-1"></a><span class="co"># chaves: wb_a3 e iso3c</span></span></code></pre></div>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb626-1"><a href="ggplot2.html#cb626-1" aria-hidden="true" tabindex="-1"></a>country.map <span class="ot">&lt;-</span> country.map <span class="sc">%&gt;%</span> </span>
<span id="cb626-2"><a href="ggplot2.html#cb626-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(gdp_growth, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;wb_a3&quot;</span> <span class="ot">=</span> <span class="st">&quot;iso3c&quot;</span>)) </span>
<span id="cb626-3"><a href="ggplot2.html#cb626-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb626-4"><a href="ggplot2.html#cb626-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(country.map, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group)) <span class="sc">+</span></span>
<span id="cb626-5"><a href="ggplot2.html#cb626-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">fill =</span> NY.GDP.MKTP.KD.ZG)) <span class="sc">+</span></span>
<span id="cb626-6"><a href="ggplot2.html#cb626-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_continuous</span>(<span class="st">&quot;Var. % GDP&quot;</span>) <span class="sc">+</span></span>
<span id="cb626-7"><a href="ggplot2.html#cb626-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_quickmap</span>()</span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>Utilizando o código “NY.GDP.PCAP.KD” e o pacote <code>WDI</code>, crie um gráfico do tipo connected dot plot comparando a renda per capita entre o Brasil e mais cinco países nos anos de 1990 e 2010.</li>
</ol>
</div>
<div id="parte-2-1" class="section level3" number="12.11.2">
<h3><span class="header-section-number">12.11.2</span> Parte 2</h3>
<ol style="list-style-type: decimal">
<li><p>Importe o arquivo salvo <code>herois_completo.csv</code> no capítulo 06. Salve no objeto <code>herois</code>. Filtre os herois que possuem peso e altura maior que 0.</p></li>
<li><p>Crie um histograma da variável altura.</p></li>
<li><p>Analise a distribuição da variável peso em função da editora dos heróis.</p></li>
<li><p>Crie um gŕafico de barras mostrando a quantidade de heróis por editora. Ordene as barras em ordem descrescente. Acrescente uma camada de texto nas barras mostrando a quantidade exata.</p></li>
<li><p>Crie um gráfico de barras mostrando a quantidade de herois bons, maus ou neutros (variável <code>alignment</code>) por editora. Use tanto <code>geom_bar()</code> como <code>geom_col()</code> para isso, usando o argumento <code>position = position_dodge()</code> para separar as barras nas editoras.</p></li>
<li><p>Repita o item anterior, trocando apenas o parâmeto <code>position = position_dodge()</code> para <code>position = position_fill()</code> para observar a proporção de personagens bons, maus ou neutros em cada editora.</p></li>
<li><p>Use o dplyr e o tidyr para criar um dataset chamado <code>hero_agg</code>, que contem a quantidade de poderes agregado por editora e heroi. Dica: transforme as colunas de super-poderes em numéricas, converta o dataframe para formato tidy, agrupe os dados por editora e heroi e calcule a soma da coluna transformada de poderes.</p></li>
<li><p>Faça um gráfico de barras mostrando os 10 herois de cada editora que possuem mais poderes. Dica: use facets para separa os herois de cada editora, usando <code>scales = "free_y" e drop = TRUE</code>. Inverta os eixos.</p></li>
<li><p>Faça um gráfico de densidade da distribuição da quantidade de poderes dos herois por editora. Use o parâmetro <code>alpha</code> para aumentar a transparência das curvas.</p></li>
<li><p>Para praticar com gráficos de séries temporais, usaremos outro dataset. Importe o dataset <code>economics</code> usando a função <code>data()</code>. Observe os dados com a função <code>head()</code>. Qual a periodicidade temporal dos dados (ex.: diário, semanal, mensal, anual) ?</p></li>
<li><p>Faça um gráfico da variável <code>unemploy</code> ao longo do tempo. Salve esse gráfico no objeto p, que será usado nos próximos itens.</p></li>
<li><p>Acrescente uma camada de área sombreada destacando o período entre 2001 a 2005.</p></li>
<li><p>Acrescente algum comentário seu no gráfico usando a função <code>geom_text()</code>.</p></li>
<li><p>Transforme o dataframe <code>economics</code> para o formato tidy. Faça um gráfico de linha de todos os indicadores econômicos ao longo do tempo, mapeando a <em>aesthetic</em> color à variável do nome do indicador. Note os problemas de escala do gráfico.</p></li>
<li><p>Repita o item anterior, acrescentando uma camada de facets que separe os gráficos por indicador. Defina o parâmetro <code>scales</code> para ter escala livre no eixo y.</p></li>
</ol>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="estruturas-complexas-de-dados.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="htmlwidgets.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["cdr-intro.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
